{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wia.live/schemas/physics/dark-matter.schema.json",
  "title": "WIA Physics Dark Matter Schema",
  "description": "Schema for dark matter research data in WIA Physics Standard",
  "version": "1.0.0",
  "type": "object",

  "properties": {
    "$schema": {
      "type": "string",
      "const": "https://wia.live/schemas/physics/dark-matter.schema.json"
    },
    "metadata": {
      "$ref": "common.schema.json#/$defs/metadata"
    },
    "detection_event": {
      "$ref": "#/$defs/detection_event"
    },
    "exclusion_limit": {
      "$ref": "#/$defs/exclusion_limit"
    },
    "axion_search": {
      "$ref": "#/$defs/axion_search"
    },
    "detector": {
      "$ref": "#/$defs/detector_info"
    },
    "background": {
      "$ref": "#/$defs/background_data"
    },
    "quality": {
      "$ref": "common.schema.json#/$defs/quality_flag"
    },
    "provenance": {
      "$ref": "common.schema.json#/$defs/provenance"
    }
  },

  "required": ["metadata"],

  "$defs": {
    "detection_event": {
      "type": "object",
      "description": "Candidate detection event",
      "properties": {
        "event_id": {
          "type": "string",
          "description": "Unique event identifier"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "recoil_energy": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Nuclear/electron recoil energy"
        },
        "ionization_signal": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Ionization signal"
        },
        "scintillation_signal": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Scintillation signal"
        },
        "phonon_signal": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Phonon signal (cryogenic detectors)"
        },
        "s1_signal": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Primary scintillation (dual-phase)"
        },
        "s2_signal": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Secondary scintillation (dual-phase)"
        },
        "signal_type": {
          "type": "string",
          "enum": ["nuclear_recoil", "electron_recoil", "multiple_scatter", "unknown"],
          "description": "Event classification"
        },
        "position": {
          "type": "object",
          "properties": {
            "x": {"$ref": "common.schema.json#/$defs/measurement"},
            "y": {"$ref": "common.schema.json#/$defs/measurement"},
            "z": {"$ref": "common.schema.json#/$defs/measurement"},
            "r": {"$ref": "common.schema.json#/$defs/measurement"},
            "drift_time": {"$ref": "common.schema.json#/$defs/measurement"}
          },
          "description": "Event position in detector"
        },
        "fiducial": {
          "type": "boolean",
          "description": "Event in fiducial volume"
        },
        "veto_status": {
          "type": "object",
          "properties": {
            "muon_veto": {"type": "boolean"},
            "neutron_veto": {"type": "boolean"},
            "outer_detector_veto": {"type": "boolean"},
            "skin_veto": {"type": "boolean"}
          }
        },
        "passed_cuts": {
          "type": "boolean",
          "description": "Event passed all analysis cuts"
        },
        "pulse_shape_discrimination": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "PSD parameter"
        }
      },
      "required": ["event_id", "timestamp", "recoil_energy", "signal_type"]
    },

    "exclusion_limit": {
      "type": "object",
      "description": "Dark matter exclusion limit",
      "properties": {
        "dm_candidate": {
          "type": "string",
          "enum": ["WIMP", "axion", "ALP", "dark_photon", "sterile_neutrino", "hidden_sector", "primordial_black_hole"],
          "description": "Dark matter candidate type"
        },
        "dm_mass": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Dark matter particle mass"
        },
        "mass_range": {
          "$ref": "common.schema.json#/$defs/range",
          "description": "Mass range covered"
        },
        "cross_section_limit": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Upper limit on cross-section"
        },
        "coupling_limit": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Upper limit on coupling constant"
        },
        "confidence_level": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence level (e.g., 0.90, 0.95)"
        },
        "interaction_type": {
          "type": "string",
          "enum": ["SI", "SD_proton", "SD_neutron", "axion_photon", "axion_electron", "axion_nucleon", "dark_photon_kinetic"],
          "description": "Type of interaction"
        },
        "limit_type": {
          "type": "string",
          "enum": ["upper", "lower", "two_sided"],
          "description": "Type of limit"
        },
        "exposure": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Total exposure (kg-days or ton-years)"
        },
        "live_time": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Live time of measurement"
        }
      },
      "required": ["dm_candidate", "confidence_level", "interaction_type"]
    },

    "axion_search": {
      "type": "object",
      "description": "Axion search parameters",
      "properties": {
        "search_type": {
          "type": "string",
          "enum": ["haloscope", "helioscope", "light_shining_through_wall", "birefringence", "quasiparticle"],
          "description": "Type of axion search"
        },
        "frequency_range": {
          "type": "object",
          "properties": {
            "min": {"$ref": "common.schema.json#/$defs/measurement"},
            "max": {"$ref": "common.schema.json#/$defs/measurement"}
          },
          "description": "Frequency range scanned"
        },
        "axion_mass_range": {
          "type": "object",
          "properties": {
            "min": {"$ref": "common.schema.json#/$defs/measurement"},
            "max": {"$ref": "common.schema.json#/$defs/measurement"}
          },
          "description": "Corresponding axion mass range"
        },
        "coupling_type": {
          "type": "string",
          "enum": ["photon", "electron", "nucleon", "gluon"],
          "description": "Axion coupling being probed"
        },
        "gagg_limit": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Limit on axion-photon coupling"
        },
        "gaee_limit": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Limit on axion-electron coupling"
        },
        "magnetic_field": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Magnetic field strength"
        },
        "cavity_volume": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Cavity volume"
        },
        "quality_factor": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Cavity Q-factor"
        },
        "scan_rate": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Frequency scan rate"
        },
        "squid_noise": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "SQUID amplifier noise temperature"
        },
        "dfsz_sensitivity": {
          "type": "boolean",
          "description": "Reached DFSZ axion sensitivity"
        },
        "ksvz_sensitivity": {
          "type": "boolean",
          "description": "Reached KSVZ axion sensitivity"
        }
      },
      "required": ["search_type"]
    },

    "detector_info": {
      "type": "object",
      "description": "Dark matter detector information",
      "properties": {
        "name": {
          "type": "string",
          "description": "Detector name"
        },
        "type": {
          "type": "string",
          "enum": ["dual_phase_xenon", "dual_phase_argon", "cryogenic_bolometer", "ccd", "bubble_chamber", "scintillator", "semiconductor", "haloscope", "helioscope"],
          "description": "Detector technology"
        },
        "target_material": {
          "type": "string",
          "description": "Target material"
        },
        "target_mass": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Active target mass"
        },
        "fiducial_mass": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Fiducial mass"
        },
        "depth": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Underground depth (m.w.e.)"
        },
        "location": {
          "type": "string",
          "description": "Laboratory location"
        },
        "energy_threshold": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Energy threshold"
        },
        "energy_resolution": {
          "type": "object",
          "properties": {
            "sigma": {"$ref": "common.schema.json#/$defs/measurement"},
            "energy": {"$ref": "common.schema.json#/$defs/measurement"}
          },
          "description": "Energy resolution at reference energy"
        },
        "position_resolution": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Position resolution"
        },
        "operating_temperature": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Operating temperature"
        }
      },
      "required": ["name", "type", "target_material"]
    },

    "background_data": {
      "type": "object",
      "description": "Background characterization",
      "properties": {
        "total_rate": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Total background rate in ROI"
        },
        "electron_recoil_rate": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Electron recoil background rate"
        },
        "nuclear_recoil_rate": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Nuclear recoil background rate"
        },
        "sources": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "rate": {"$ref": "common.schema.json#/$defs/measurement"},
              "origin": {"type": "string"}
            }
          },
          "description": "Individual background sources"
        },
        "discrimination_factor": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "ER/NR discrimination factor"
        }
      }
    },

    "halo_model": {
      "type": "object",
      "description": "Dark matter halo model parameters",
      "properties": {
        "model": {
          "type": "string",
          "enum": ["SHM", "SHM++", "stream", "debris_flow", "custom"],
          "description": "Halo model"
        },
        "local_density": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Local DM density (GeV/cm^3)"
        },
        "v0": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Velocity dispersion (km/s)"
        },
        "vesc": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Galactic escape velocity (km/s)"
        },
        "vearth": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Earth velocity in galactic frame (km/s)"
        }
      }
    }
  }
}
