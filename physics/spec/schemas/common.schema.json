{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wia.live/schemas/physics/common.schema.json",
  "title": "WIA Physics Common Types",
  "description": "Common type definitions for WIA Physics Standard",
  "version": "1.0.0",

  "$defs": {
    "uncertainty": {
      "type": "object",
      "description": "Measurement uncertainty specification",
      "properties": {
        "statistical": {
          "type": "number",
          "minimum": 0,
          "description": "Statistical (random) uncertainty"
        },
        "systematic": {
          "type": "number",
          "minimum": 0,
          "description": "Systematic uncertainty"
        },
        "total": {
          "type": "number",
          "minimum": 0,
          "description": "Total combined uncertainty"
        }
      },
      "required": ["total"]
    },

    "measurement": {
      "type": "object",
      "description": "Physical measurement with uncertainty",
      "properties": {
        "value": {
          "type": "number",
          "description": "Central value of measurement"
        },
        "uncertainty": {
          "$ref": "#/$defs/uncertainty"
        },
        "unit": {
          "type": "string",
          "description": "Physical unit (SI or derived)"
        },
        "confidence_level": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.68,
          "description": "Confidence level for uncertainty (default 1-sigma)"
        }
      },
      "required": ["value", "uncertainty", "unit"]
    },

    "physical_quantity": {
      "type": "object",
      "description": "Named physical quantity",
      "properties": {
        "name": {
          "type": "string",
          "description": "Quantity name"
        },
        "symbol": {
          "type": "string",
          "description": "Mathematical symbol"
        },
        "value": {
          "type": "number"
        },
        "uncertainty": {
          "$ref": "#/$defs/uncertainty"
        },
        "unit": {
          "type": "string"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["name", "value", "unit"]
    },

    "coordinate_system": {
      "type": "object",
      "description": "Spatial coordinate system definition",
      "properties": {
        "system": {
          "type": "string",
          "enum": ["cartesian", "cylindrical", "spherical", "toroidal"],
          "description": "Coordinate system type"
        },
        "axes": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Axis labels"
        },
        "origin": {
          "type": "object",
          "properties": {
            "description": {"type": "string"},
            "coordinates": {
              "type": "array",
              "items": {"type": "number"}
            }
          }
        },
        "unit": {
          "type": "string",
          "description": "Length unit for coordinates"
        }
      },
      "required": ["system", "unit"]
    },

    "vector3d": {
      "type": "object",
      "description": "3D vector with uncertainty",
      "properties": {
        "x": {"$ref": "#/$defs/measurement"},
        "y": {"$ref": "#/$defs/measurement"},
        "z": {"$ref": "#/$defs/measurement"},
        "coordinate_system": {
          "type": "string",
          "default": "cartesian"
        }
      },
      "required": ["x", "y", "z"]
    },

    "time_range": {
      "type": "object",
      "description": "Time interval specification",
      "properties": {
        "start": {
          "type": "string",
          "format": "date-time"
        },
        "end": {
          "type": "string",
          "format": "date-time"
        },
        "duration": {
          "$ref": "#/$defs/measurement"
        }
      }
    },

    "range": {
      "type": "object",
      "description": "Numerical range",
      "properties": {
        "min": {"type": "number"},
        "max": {"type": "number"},
        "unit": {"type": "string"}
      },
      "required": ["min", "max"]
    },

    "creator": {
      "type": "object",
      "description": "Data creator information",
      "properties": {
        "name": {"type": "string"},
        "institution": {"type": "string"},
        "orcid": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{4}-\\d{4}-\\d{3}[0-9X]$"
        },
        "email": {
          "type": "string",
          "format": "email"
        }
      },
      "required": ["name"]
    },

    "experiment_info": {
      "type": "object",
      "description": "Experiment metadata",
      "properties": {
        "name": {"type": "string"},
        "facility": {"type": "string"},
        "collaboration": {"type": "string"},
        "run_period": {"type": "string"},
        "detector": {"type": "string"}
      },
      "required": ["name"]
    },

    "metadata": {
      "type": "object",
      "description": "Standard metadata block",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "created": {
          "type": "string",
          "format": "date-time"
        },
        "modified": {
          "type": "string",
          "format": "date-time"
        },
        "creator": {
          "$ref": "#/$defs/creator"
        },
        "experiment": {
          "$ref": "#/$defs/experiment_info"
        },
        "license": {
          "type": "string",
          "default": "CC-BY-4.0"
        },
        "doi": {"type": "string"},
        "keywords": {
          "type": "array",
          "items": {"type": "string"}
        },
        "description": {"type": "string"}
      },
      "required": ["id", "created"]
    },

    "quality_flag": {
      "type": "string",
      "enum": ["GOOD", "SUSPECT", "BAD", "UNCHECKED", "SIMULATED"],
      "description": "Data quality indicator"
    },

    "provenance_step": {
      "type": "object",
      "description": "Single processing step in provenance chain",
      "properties": {
        "step": {"type": "string"},
        "software": {"type": "string"},
        "version": {"type": "string"},
        "parameters": {"type": "object"},
        "timestamp": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["step", "timestamp"]
    },

    "provenance": {
      "type": "object",
      "description": "Data provenance information",
      "properties": {
        "source": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["measurement", "simulation", "derived", "reference"]
            },
            "origin": {"type": "string"}
          },
          "required": ["type"]
        },
        "processing": {
          "type": "array",
          "items": {"$ref": "#/$defs/provenance_step"}
        },
        "calibration": {
          "type": "object",
          "properties": {
            "date": {
              "type": "string",
              "format": "date-time"
            },
            "reference": {"type": "string"},
            "validity": {"type": "string"}
          }
        }
      }
    },

    "unit_system": {
      "type": "string",
      "enum": ["SI", "natural", "CGS", "planck"],
      "default": "SI",
      "description": "Unit system used in data"
    }
  }
}
