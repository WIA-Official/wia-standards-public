{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wia.live/schemas/physics/particle.schema.json",
  "title": "WIA Physics Particle Schema",
  "description": "Schema for particle physics data in WIA Physics Standard",
  "version": "1.0.0",
  "type": "object",

  "properties": {
    "$schema": {
      "type": "string",
      "const": "https://wia.live/schemas/physics/particle.schema.json"
    },
    "metadata": {
      "$ref": "common.schema.json#/$defs/metadata"
    },
    "particle": {
      "$ref": "#/$defs/particle_properties"
    },
    "event": {
      "$ref": "#/$defs/collision_event"
    },
    "cross_section": {
      "$ref": "#/$defs/cross_section_data"
    },
    "decay": {
      "$ref": "#/$defs/decay_data"
    },
    "quality": {
      "$ref": "common.schema.json#/$defs/quality_flag"
    },
    "provenance": {
      "$ref": "common.schema.json#/$defs/provenance"
    }
  },

  "required": ["metadata"],

  "$defs": {
    "particle_properties": {
      "type": "object",
      "description": "Fundamental particle properties",
      "properties": {
        "name": {
          "type": "string",
          "description": "Particle name (PDG naming convention)"
        },
        "pdg_id": {
          "type": "integer",
          "description": "Particle Data Group ID"
        },
        "mass": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Rest mass (GeV/c^2 or MeV/c^2)"
        },
        "charge": {
          "type": "number",
          "description": "Electric charge in units of e"
        },
        "spin": {
          "type": "number",
          "description": "Spin quantum number"
        },
        "parity": {
          "type": "integer",
          "enum": [-1, 1],
          "description": "Intrinsic parity"
        },
        "c_parity": {
          "type": "integer",
          "enum": [-1, 1],
          "description": "Charge conjugation parity"
        },
        "isospin": {
          "type": "number",
          "description": "Isospin quantum number"
        },
        "isospin_3": {
          "type": "number",
          "description": "Third component of isospin"
        },
        "strangeness": {
          "type": "integer",
          "description": "Strangeness quantum number"
        },
        "charm": {
          "type": "integer",
          "description": "Charm quantum number"
        },
        "bottomness": {
          "type": "integer",
          "description": "Bottomness quantum number"
        },
        "topness": {
          "type": "integer",
          "description": "Topness quantum number"
        },
        "baryon_number": {
          "type": "number",
          "description": "Baryon number"
        },
        "lepton_number": {
          "type": "integer",
          "description": "Lepton number"
        },
        "lifetime": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Mean lifetime"
        },
        "width": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Decay width (GeV)"
        },
        "magnetic_moment": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Magnetic moment"
        },
        "particle_type": {
          "type": "string",
          "enum": ["fermion", "boson", "lepton", "quark", "hadron", "meson", "baryon", "gauge_boson", "scalar"],
          "description": "Particle classification"
        }
      },
      "required": ["name", "pdg_id", "mass", "charge", "spin"]
    },

    "four_momentum": {
      "type": "object",
      "description": "Four-momentum vector",
      "properties": {
        "e": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Energy component"
        },
        "px": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "x-momentum component"
        },
        "py": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "y-momentum component"
        },
        "pz": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "z-momentum component"
        },
        "pt": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Transverse momentum"
        },
        "eta": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Pseudorapidity"
        },
        "phi": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Azimuthal angle"
        },
        "mass": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Invariant mass"
        }
      },
      "required": ["e", "px", "py", "pz"]
    },

    "track": {
      "type": "object",
      "description": "Reconstructed particle track",
      "properties": {
        "track_id": {
          "type": "string"
        },
        "particle_id": {
          "type": "integer",
          "description": "PDG ID of identified particle"
        },
        "momentum": {
          "$ref": "#/$defs/four_momentum"
        },
        "vertex_id": {
          "type": "string",
          "description": "Associated vertex"
        },
        "charge": {
          "type": "integer"
        },
        "chi2": {
          "type": "number",
          "description": "Track fit chi-squared"
        },
        "ndof": {
          "type": "integer",
          "description": "Degrees of freedom"
        },
        "d0": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Transverse impact parameter"
        },
        "z0": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Longitudinal impact parameter"
        }
      },
      "required": ["track_id", "momentum"]
    },

    "vertex": {
      "type": "object",
      "description": "Interaction vertex",
      "properties": {
        "vertex_id": {
          "type": "string"
        },
        "x": {
          "$ref": "common.schema.json#/$defs/measurement"
        },
        "y": {
          "$ref": "common.schema.json#/$defs/measurement"
        },
        "z": {
          "$ref": "common.schema.json#/$defs/measurement"
        },
        "type": {
          "type": "string",
          "enum": ["primary", "secondary", "pileup"]
        },
        "ntracks": {
          "type": "integer",
          "description": "Number of associated tracks"
        },
        "chi2": {
          "type": "number"
        }
      },
      "required": ["vertex_id", "x", "y", "z"]
    },

    "jet": {
      "type": "object",
      "description": "Reconstructed jet",
      "properties": {
        "jet_id": {
          "type": "string"
        },
        "algorithm": {
          "type": "string",
          "enum": ["anti-kt", "kt", "cambridge", "cone"],
          "description": "Jet algorithm"
        },
        "radius": {
          "type": "number",
          "description": "Jet radius parameter"
        },
        "momentum": {
          "$ref": "#/$defs/four_momentum"
        },
        "btag_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "B-tagging discriminant"
        },
        "flavor": {
          "type": "string",
          "enum": ["b", "c", "light", "tau", "unknown"]
        },
        "constituents": {
          "type": "integer",
          "description": "Number of constituents"
        }
      },
      "required": ["jet_id", "momentum"]
    },

    "missing_et": {
      "type": "object",
      "description": "Missing transverse energy",
      "properties": {
        "met": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Missing transverse energy magnitude"
        },
        "phi": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Missing ET direction"
        },
        "sum_et": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Scalar sum of transverse energy"
        }
      },
      "required": ["met", "phi"]
    },

    "collision_event": {
      "type": "object",
      "description": "Collision event data",
      "properties": {
        "event_id": {
          "type": "string",
          "description": "Unique event identifier"
        },
        "run_number": {
          "type": "integer"
        },
        "luminosity_block": {
          "type": "integer"
        },
        "event_number": {
          "type": "integer"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "collision": {
          "type": "object",
          "properties": {
            "sqrt_s": {
              "$ref": "common.schema.json#/$defs/measurement",
              "description": "Center-of-mass energy"
            },
            "beam1": {
              "type": "string"
            },
            "beam2": {
              "type": "string"
            },
            "collision_type": {
              "type": "string",
              "enum": ["pp", "pPb", "PbPb", "ee", "ep", "other"]
            }
          },
          "required": ["sqrt_s", "beam1", "beam2"]
        },
        "vertices": {
          "type": "array",
          "items": {"$ref": "#/$defs/vertex"}
        },
        "tracks": {
          "type": "array",
          "items": {"$ref": "#/$defs/track"}
        },
        "jets": {
          "type": "array",
          "items": {"$ref": "#/$defs/jet"}
        },
        "electrons": {
          "type": "array",
          "items": {"$ref": "#/$defs/four_momentum"}
        },
        "muons": {
          "type": "array",
          "items": {"$ref": "#/$defs/four_momentum"}
        },
        "photons": {
          "type": "array",
          "items": {"$ref": "#/$defs/four_momentum"}
        },
        "missing_et": {
          "$ref": "#/$defs/missing_et"
        },
        "trigger": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Fired triggers"
        },
        "pileup": {
          "type": "integer",
          "description": "Number of pileup interactions"
        }
      },
      "required": ["event_id", "collision"]
    },

    "cross_section_data": {
      "type": "object",
      "description": "Cross-section measurement",
      "properties": {
        "process": {
          "type": "string",
          "description": "Process description"
        },
        "sqrt_s": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Center-of-mass energy"
        },
        "cross_section": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Measured cross-section"
        },
        "integrated_luminosity": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Integrated luminosity"
        },
        "significance": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Statistical significance (sigma)"
        },
        "fiducial_region": {
          "type": "string",
          "description": "Fiducial region definition"
        },
        "theory_prediction": {
          "$ref": "common.schema.json#/$defs/measurement",
          "description": "Theoretical prediction"
        }
      },
      "required": ["process", "sqrt_s", "cross_section"]
    },

    "decay_mode": {
      "type": "object",
      "description": "Particle decay mode",
      "properties": {
        "products": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Decay products (PDG names)"
        },
        "branching_ratio": {
          "$ref": "common.schema.json#/$defs/measurement"
        },
        "partial_width": {
          "$ref": "common.schema.json#/$defs/measurement"
        }
      },
      "required": ["products", "branching_ratio"]
    },

    "decay_data": {
      "type": "object",
      "description": "Decay information",
      "properties": {
        "parent": {
          "type": "string",
          "description": "Parent particle"
        },
        "total_width": {
          "$ref": "common.schema.json#/$defs/measurement"
        },
        "modes": {
          "type": "array",
          "items": {"$ref": "#/$defs/decay_mode"}
        }
      },
      "required": ["parent"]
    }
  }
}
