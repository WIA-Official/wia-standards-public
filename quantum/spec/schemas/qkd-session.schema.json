{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://quantum.wia.live/schemas/qkd-session.schema.json",
  "title": "WIA Quantum QKD Session",
  "description": "Quantum Key Distribution session following WIA Quantum standard",
  "type": "object",
  "required": ["wia_quantum_version", "type", "crypto_type", "session_id", "protocol", "participants"],
  "properties": {
    "wia_quantum_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "type": {
      "type": "string",
      "const": "crypto"
    },
    "crypto_type": {
      "type": "string",
      "const": "qkd_session"
    },
    "session_id": {
      "type": "string",
      "format": "uuid"
    },
    "protocol": {
      "type": "string",
      "enum": ["BB84", "E91", "BBM92", "SARG04", "COW", "DPS"],
      "description": "QKD protocol"
    },
    "participants": {
      "type": "object",
      "properties": {
        "alice": {
          "$ref": "#/definitions/participant"
        },
        "bob": {
          "$ref": "#/definitions/participant"
        }
      },
      "required": ["alice", "bob"]
    },
    "channel": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["fiber", "free_space", "satellite"]
        },
        "length_km": {
          "type": "number",
          "minimum": 0
        },
        "loss_db": {
          "type": "number"
        }
      }
    },
    "statistics": {
      "type": "object",
      "properties": {
        "raw_key_rate_bps": {
          "type": "number",
          "description": "Raw key generation rate"
        },
        "qber": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Quantum Bit Error Rate"
        },
        "secure_key_rate_bps": {
          "type": "number",
          "description": "Secure key rate after error correction"
        },
        "total_key_bits": {
          "type": "integer",
          "description": "Total secure key bits generated"
        }
      }
    },
    "status": {
      "type": "string",
      "enum": ["initializing", "active", "paused", "completed", "failed"]
    },
    "started_at": {
      "type": "string",
      "format": "date-time"
    },
    "ended_at": {
      "type": "string",
      "format": "date-time"
    }
  },
  "definitions": {
    "participant": {
      "type": "object",
      "required": ["node_id"],
      "properties": {
        "node_id": { "type": "string" },
        "address": { "type": "string" }
      }
    }
  }
}
