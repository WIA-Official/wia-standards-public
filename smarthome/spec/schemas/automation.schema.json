{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wia.live/schemas/smarthome/automation.schema.json",
  "title": "WIA Smart Home Automation",
  "description": "Automation rules with accessibility considerations",
  "type": "object",
  "required": ["automation_id", "name", "home_id", "trigger", "actions"],
  "properties": {
    "automation_id": {
      "type": "string",
      "format": "uuid"
    },
    "name": {
      "type": "string",
      "maxLength": 100
    },
    "description": {
      "type": "string"
    },
    "enabled": {
      "type": "boolean",
      "default": true
    },
    "home_id": {
      "type": "string",
      "format": "uuid"
    },
    "zone_ids": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "uuid"
      },
      "description": "Zones this automation applies to"
    },
    "trigger": {
      "$ref": "#/$defs/Trigger"
    },
    "conditions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Condition"
      }
    },
    "actions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Action"
      },
      "minItems": 1
    },
    "accessibility_settings": {
      "type": "object",
      "properties": {
        "announce_activation": {
          "type": "boolean",
          "default": true,
          "description": "Announce when automation activates"
        },
        "announcement_text": {
          "type": "string",
          "description": "Custom announcement text"
        },
        "confirmation_required": {
          "type": "boolean",
          "default": false,
          "description": "Require user confirmation before executing"
        },
        "override_priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "default": "low",
          "description": "Priority for user override"
        },
        "safe_mode_behavior": {
          "type": "string",
          "enum": ["execute", "skip", "confirm"],
          "default": "confirm",
          "description": "Behavior when user's safe mode is active"
        }
      }
    },
    "schedule": {
      "type": "object",
      "properties": {
        "active_days": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["mon", "tue", "wed", "thu", "fri", "sat", "sun"]
          }
        },
        "active_start_time": {
          "type": "string",
          "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
        },
        "active_end_time": {
          "type": "string",
          "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
        },
        "respect_quiet_hours": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time"
    },
    "last_triggered_at": {
      "type": "string",
      "format": "date-time"
    },
    "trigger_count": {
      "type": "integer",
      "default": 0
    }
  },
  "$defs": {
    "Trigger": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "time",
            "sunrise",
            "sunset",
            "device_state",
            "sensor_value",
            "location",
            "voice_command",
            "manual",
            "schedule"
          ]
        },
        "config": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "Condition": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "time_range",
            "day_of_week",
            "device_state",
            "sensor_value",
            "zone_occupancy",
            "user_presence",
            "sun_position",
            "weather"
          ]
        },
        "config": {
          "type": "object",
          "additionalProperties": true
        },
        "operator": {
          "type": "string",
          "enum": ["and", "or", "not"],
          "default": "and"
        }
      }
    },
    "Action": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "device_control",
            "scene_activate",
            "notification",
            "delay",
            "condition_check",
            "webhook",
            "voice_announcement"
          ]
        },
        "device_id": {
          "type": "string",
          "format": "uuid"
        },
        "command": {
          "type": "string"
        },
        "parameters": {
          "type": "object",
          "additionalProperties": true
        },
        "delay_ms": {
          "type": "integer",
          "minimum": 0
        }
      }
    }
  }
}
