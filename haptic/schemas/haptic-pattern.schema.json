{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia-standards.org/schemas/haptic/haptic-pattern.schema.json",
  "title": "WIA Haptic Pattern Schema",
  "description": "JSON Schema for defining haptic patterns in the WIA Haptic Standard",
  "version": "1.0.0",

  "definitions": {
    "waveformType": {
      "type": "string",
      "enum": ["sine", "square", "triangle", "sawtooth", "noise"],
      "description": "Basic waveform type for haptic signal generation"
    },

    "noiseType": {
      "type": "string",
      "enum": ["white", "pink", "brown"],
      "description": "Type of noise waveform"
    },

    "waveformConfig": {
      "type": "object",
      "properties": {
        "type": {
          "$ref": "#/definitions/waveformType"
        },
        "dutyCycle": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.5,
          "description": "Duty cycle for square waves (0.0-1.0)"
        },
        "smoothing": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0,
          "description": "Smoothing factor for transitions (0.0-1.0)"
        },
        "noiseType": {
          "$ref": "#/definitions/noiseType"
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },

    "envelope": {
      "type": "object",
      "description": "ADSR envelope for shaping haptic signal amplitude",
      "properties": {
        "attack": {
          "type": "number",
          "minimum": 0,
          "maximum": 500,
          "default": 10,
          "description": "Attack time in milliseconds (0-500ms)"
        },
        "decay": {
          "type": "number",
          "minimum": 0,
          "maximum": 500,
          "default": 50,
          "description": "Decay time in milliseconds (0-500ms)"
        },
        "sustain": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.7,
          "description": "Sustain level (0.0-1.0)"
        },
        "release": {
          "type": "number",
          "minimum": 0,
          "maximum": 500,
          "default": 100,
          "description": "Release time in milliseconds (0-500ms)"
        }
      },
      "required": ["attack", "decay", "sustain", "release"],
      "additionalProperties": false
    },

    "envelopePreset": {
      "type": "string",
      "enum": ["sharp", "punch", "smooth", "pulse", "swell", "fade"],
      "description": "Predefined envelope preset"
    },

    "frequencyBand": {
      "type": "string",
      "enum": ["very_low", "low", "mid", "high", "very_high"],
      "description": "Frequency band classification"
    },

    "intensityLevel": {
      "type": "string",
      "enum": ["subtle", "light", "medium", "strong", "maximum"],
      "description": "Predefined intensity level"
    },

    "intensityModulation": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["none", "pulse", "wave", "random"],
          "default": "none"
        },
        "rate": {
          "type": "number",
          "minimum": 0.1,
          "maximum": 20,
          "description": "Modulation rate in Hz"
        },
        "depth": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Modulation depth (0.0-1.0)"
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },

    "hapticCategory": {
      "type": "string",
      "enum": [
        "navigation",
        "notification",
        "confirmation",
        "spatial",
        "temporal",
        "social",
        "system",
        "content"
      ],
      "description": "Semantic category of the haptic pattern"
    },

    "learnability": {
      "type": "string",
      "enum": ["easy", "moderate", "complex"],
      "description": "How easy the pattern is to learn and distinguish"
    },

    "hapticPrimitive": {
      "type": "object",
      "description": "A single haptic primitive - the basic building block",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$",
          "description": "Unique identifier (lowercase, underscores allowed)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "description": "Human-readable name"
        },
        "waveform": {
          "oneOf": [
            { "$ref": "#/definitions/waveformConfig" },
            { "$ref": "#/definitions/waveformType" }
          ],
          "description": "Waveform configuration or simple type"
        },
        "envelope": {
          "oneOf": [
            { "$ref": "#/definitions/envelope" },
            { "$ref": "#/definitions/envelopePreset" }
          ],
          "description": "Envelope configuration or preset name"
        },
        "frequency": {
          "type": "number",
          "minimum": 1,
          "maximum": 300,
          "description": "Vibration frequency in Hz (1-300Hz)"
        },
        "frequencyBand": {
          "$ref": "#/definitions/frequencyBand"
        },
        "intensity": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Base intensity (0.0-1.0)"
        },
        "intensityLevel": {
          "$ref": "#/definitions/intensityLevel"
        },
        "intensityModulation": {
          "$ref": "#/definitions/intensityModulation"
        },
        "duration": {
          "type": "number",
          "minimum": 1,
          "maximum": 10000,
          "description": "Duration in milliseconds"
        },
        "metadata": {
          "type": "object",
          "properties": {
            "category": {
              "$ref": "#/definitions/hapticCategory"
            },
            "description": {
              "type": "string",
              "maxLength": 200
            },
            "learnability": {
              "$ref": "#/definitions/learnability"
            },
            "tags": {
              "type": "array",
              "items": { "type": "string" },
              "maxItems": 10
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["id", "name", "waveform", "envelope", "frequency", "intensity", "duration"],
      "additionalProperties": false
    },

    "sequenceStep": {
      "type": "object",
      "description": "A step in a haptic sequence",
      "properties": {
        "primitiveId": {
          "type": "string",
          "description": "Reference to a primitive ID"
        },
        "primitive": {
          "$ref": "#/definitions/hapticPrimitive",
          "description": "Inline primitive definition"
        },
        "delayBefore": {
          "type": "number",
          "minimum": 0,
          "maximum": 10000,
          "default": 0,
          "description": "Delay before this step in milliseconds"
        },
        "repeatCount": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 1,
          "description": "Number of times to repeat this step"
        },
        "repeatDelay": {
          "type": "number",
          "minimum": 0,
          "maximum": 5000,
          "default": 0,
          "description": "Delay between repeats in milliseconds"
        },
        "intensityScale": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "default": 1,
          "description": "Scale factor for intensity (0.0-2.0)"
        }
      },
      "oneOf": [
        { "required": ["primitiveId"] },
        { "required": ["primitive"] }
      ],
      "additionalProperties": false
    },

    "hapticSequence": {
      "type": "object",
      "description": "A sequence of haptic primitives",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50
        },
        "steps": {
          "type": "array",
          "items": { "$ref": "#/definitions/sequenceStep" },
          "minItems": 1,
          "maxItems": 50
        },
        "loop": {
          "type": "boolean",
          "default": false,
          "description": "Whether the sequence should loop"
        },
        "loopCount": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "Number of times to loop (if loop is true)"
        },
        "metadata": {
          "type": "object",
          "properties": {
            "category": { "$ref": "#/definitions/hapticCategory" },
            "description": { "type": "string", "maxLength": 200 },
            "totalDuration": { "type": "number", "description": "Calculated total duration" },
            "tags": { "type": "array", "items": { "type": "string" } }
          },
          "additionalProperties": false
        }
      },
      "required": ["id", "name", "steps"],
      "additionalProperties": false
    },

    "bodyLocation": {
      "type": "string",
      "enum": [
        "forehead_left", "forehead_center", "forehead_right",
        "temple_left", "temple_right",
        "neck_left", "neck_center", "neck_right", "neck_back",
        "shoulder_left", "shoulder_right",
        "upper_arm_left", "upper_arm_right",
        "elbow_left", "elbow_right",
        "forearm_left", "forearm_right",
        "wrist_left_dorsal", "wrist_left_volar",
        "wrist_right_dorsal", "wrist_right_volar",
        "palm_left", "palm_right",
        "back_hand_left", "back_hand_right",
        "thumb_left", "index_left", "middle_left", "ring_left", "pinky_left",
        "thumb_right", "index_right", "middle_right", "ring_right", "pinky_right",
        "chest_left", "chest_center", "chest_right",
        "abdomen_left", "abdomen_center", "abdomen_right",
        "back_upper_left", "back_upper_center", "back_upper_right",
        "back_lower_left", "back_lower_center", "back_lower_right",
        "waist_left", "waist_front", "waist_right", "waist_back",
        "thigh_left", "thigh_right",
        "knee_left", "knee_right",
        "calf_left", "calf_right",
        "ankle_left", "ankle_right",
        "foot_left", "foot_right"
      ],
      "description": "Body location for haptic actuator"
    },

    "spatialPattern": {
      "type": "object",
      "description": "A pattern with spatial/location information",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "name": {
          "type": "string"
        },
        "actuations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "location": {
                "$ref": "#/definitions/bodyLocation"
              },
              "locations": {
                "type": "array",
                "items": { "$ref": "#/definitions/bodyLocation" },
                "description": "Multiple locations for simultaneous activation"
              },
              "pattern": {
                "oneOf": [
                  { "type": "string", "description": "Reference to primitive or sequence ID" },
                  { "$ref": "#/definitions/hapticPrimitive" },
                  { "$ref": "#/definitions/hapticSequence" }
                ]
              },
              "startTime": {
                "type": "number",
                "minimum": 0,
                "description": "Start time in milliseconds"
              },
              "intensityScale": {
                "type": "number",
                "minimum": 0,
                "maximum": 2,
                "default": 1
              }
            },
            "oneOf": [
              { "required": ["location", "pattern"] },
              { "required": ["locations", "pattern"] }
            ],
            "additionalProperties": false
          },
          "minItems": 1
        },
        "metadata": {
          "type": "object",
          "properties": {
            "category": { "$ref": "#/definitions/hapticCategory" },
            "description": { "type": "string" },
            "direction": {
              "type": "string",
              "enum": ["forward", "backward", "left", "right", "up", "down", "clockwise", "counterclockwise"]
            }
          },
          "additionalProperties": true
        }
      },
      "required": ["id", "name", "actuations"],
      "additionalProperties": false
    }
  },

  "type": "object",
  "properties": {
    "$schema": {
      "type": "string"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version (semver)"
    },
    "primitives": {
      "type": "array",
      "items": { "$ref": "#/definitions/hapticPrimitive" },
      "description": "Library of haptic primitives"
    },
    "sequences": {
      "type": "array",
      "items": { "$ref": "#/definitions/hapticSequence" },
      "description": "Library of haptic sequences"
    },
    "spatialPatterns": {
      "type": "array",
      "items": { "$ref": "#/definitions/spatialPattern" },
      "description": "Library of spatial haptic patterns"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "author": { "type": "string" },
        "license": { "type": "string" },
        "created": { "type": "string", "format": "date-time" },
        "modified": { "type": "string", "format": "date-time" }
      },
      "additionalProperties": true
    }
  },
  "required": ["version"],
  "additionalProperties": false
}
