{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.family/schemas/eye-gaze/device-capability.schema.json",
  "title": "WIA Eye Gaze Device Capability Schema",
  "description": "Standard schema for eye tracker device capabilities in WIA Eye Gaze Interoperability Protocol",
  "version": "1.0.0-draft",
  "type": "object",
  "required": ["device", "tracking", "data", "calibration", "connectivity", "supportedFeatures"],
  "properties": {
    "device": {
      "$ref": "#/definitions/EyeTrackerInfo",
      "description": "Basic device information"
    },
    "tracking": {
      "$ref": "#/definitions/TrackingCapabilities",
      "description": "Tracking capabilities"
    },
    "data": {
      "$ref": "#/definitions/DataCapabilities",
      "description": "Data output capabilities"
    },
    "calibration": {
      "$ref": "#/definitions/CalibrationCapabilities",
      "description": "Calibration capabilities"
    },
    "accessibility": {
      "$ref": "#/definitions/AccessibilityCapabilities",
      "description": "Accessibility and AAC capabilities"
    },
    "connectivity": {
      "$ref": "#/definitions/ConnectivityCapabilities",
      "description": "Connectivity capabilities"
    },
    "supportedFeatures": {
      "type": "array",
      "description": "List of supported feature flags",
      "items": {
        "$ref": "#/definitions/FeatureFlag"
      }
    }
  },
  "definitions": {
    "DeviceType": {
      "type": "string",
      "enum": ["screen_based", "wearable", "remote", "integrated", "webcam_based", "unknown"]
    },
    "EyeTrackerInfo": {
      "type": "object",
      "required": ["deviceId", "vendor", "model", "firmwareVersion", "protocolVersion"],
      "properties": {
        "deviceId": {
          "type": "string",
          "description": "Unique device identifier"
        },
        "vendor": {
          "type": "string",
          "description": "Device vendor/manufacturer"
        },
        "model": {
          "type": "string",
          "description": "Device model name"
        },
        "firmwareVersion": {
          "type": "string",
          "description": "Firmware version"
        },
        "protocolVersion": {
          "type": "string",
          "description": "WIA protocol version supported"
        },
        "serialNumber": {
          "type": "string",
          "description": "Serial number"
        },
        "deviceType": {
          "$ref": "#/definitions/DeviceType",
          "description": "Type of eye tracker"
        },
        "vendorUrl": {
          "type": "string",
          "format": "uri",
          "description": "Vendor website URL"
        },
        "productUrl": {
          "type": "string",
          "format": "uri",
          "description": "Product page URL"
        },
        "metadata": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "SamplingRateSpec": {
      "type": "object",
      "required": ["supported", "default"],
      "properties": {
        "supported": {
          "type": "array",
          "items": { "type": "integer", "minimum": 1 },
          "description": "Supported sampling rates in Hz"
        },
        "default": {
          "type": "integer",
          "minimum": 1,
          "description": "Default sampling rate"
        },
        "current": {
          "type": "integer",
          "minimum": 1,
          "description": "Current sampling rate"
        }
      }
    },
    "AccuracySpec": {
      "type": "object",
      "required": ["typical"],
      "properties": {
        "typical": {
          "type": "number",
          "minimum": 0,
          "description": "Typical accuracy in degrees"
        },
        "best": {
          "type": "number",
          "minimum": 0,
          "description": "Best case accuracy in degrees"
        },
        "measurementMethod": {
          "type": "string",
          "description": "Method used for accuracy measurement"
        }
      }
    },
    "PrecisionSpec": {
      "type": "object",
      "required": ["typical"],
      "properties": {
        "typical": {
          "type": "number",
          "minimum": 0,
          "description": "Typical precision in degrees"
        },
        "rms": {
          "type": "number",
          "minimum": 0,
          "description": "RMS precision"
        }
      }
    },
    "LatencySpec": {
      "type": "object",
      "required": ["average"],
      "properties": {
        "average": {
          "type": "number",
          "minimum": 0,
          "description": "Average latency in ms"
        },
        "maximum": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum latency in ms"
        }
      }
    },
    "RangeSpec": {
      "type": "object",
      "required": ["min", "max"],
      "properties": {
        "min": { "type": "number" },
        "max": { "type": "number" },
        "optimal": { "type": "number" }
      }
    },
    "TrackingAreaSpec": {
      "type": "object",
      "required": ["horizontal", "vertical"],
      "properties": {
        "horizontal": {
          "type": "number",
          "description": "Horizontal tracking range in degrees"
        },
        "vertical": {
          "type": "number",
          "description": "Vertical tracking range in degrees"
        }
      }
    },
    "HeadMovementSpec": {
      "type": "object",
      "required": ["horizontal", "vertical", "depth"],
      "properties": {
        "horizontal": {
          "type": "number",
          "description": "Horizontal movement tolerance in cm"
        },
        "vertical": {
          "type": "number",
          "description": "Vertical movement tolerance in cm"
        },
        "depth": {
          "type": "number",
          "description": "Depth movement tolerance in cm"
        }
      }
    },
    "TrackingCapabilities": {
      "type": "object",
      "required": ["binocular", "headTracking", "gaze3D", "samplingRate", "accuracy", "precision", "latency", "operatingDistance", "trackingArea"],
      "properties": {
        "binocular": {
          "type": "boolean",
          "description": "Supports binocular tracking"
        },
        "headTracking": {
          "type": "boolean",
          "description": "Supports head position tracking"
        },
        "gaze3D": {
          "type": "boolean",
          "description": "Supports 3D gaze tracking"
        },
        "samplingRate": {
          "$ref": "#/definitions/SamplingRateSpec"
        },
        "accuracy": {
          "$ref": "#/definitions/AccuracySpec"
        },
        "precision": {
          "$ref": "#/definitions/PrecisionSpec"
        },
        "latency": {
          "$ref": "#/definitions/LatencySpec"
        },
        "operatingDistance": {
          "$ref": "#/definitions/RangeSpec",
          "description": "Operating distance range in cm"
        },
        "trackingArea": {
          "$ref": "#/definitions/TrackingAreaSpec"
        },
        "headMovementTolerance": {
          "$ref": "#/definitions/HeadMovementSpec"
        }
      }
    },
    "DataCapabilities": {
      "type": "object",
      "required": [
        "gazePoint", "eyeData", "pupilDiameter", "pupilPosition",
        "eyeOpenness", "eyeImages", "gazeOrigin3D", "gazeDirection3D",
        "builtInFixationDetection", "builtInSaccadeDetection", "builtInBlinkDetection",
        "deviceTimestamp", "systemTimestamp", "externalSync"
      ],
      "properties": {
        "gazePoint": { "type": "boolean" },
        "eyeData": { "type": "boolean" },
        "pupilDiameter": { "type": "boolean" },
        "pupilPosition": { "type": "boolean" },
        "eyeOpenness": { "type": "boolean" },
        "eyeImages": { "type": "boolean" },
        "gazeOrigin3D": { "type": "boolean" },
        "gazeDirection3D": { "type": "boolean" },
        "builtInFixationDetection": { "type": "boolean" },
        "builtInSaccadeDetection": { "type": "boolean" },
        "builtInBlinkDetection": { "type": "boolean" },
        "deviceTimestamp": { "type": "boolean" },
        "systemTimestamp": { "type": "boolean" },
        "externalSync": { "type": "boolean" }
      }
    },
    "CalibrationType": {
      "type": "string",
      "enum": ["standard", "quick", "infant", "gaming", "accessibility", "automatic"]
    },
    "CalibrationCapabilities": {
      "type": "object",
      "required": ["required", "types", "pointOptions", "defaultPoints", "autoCalibration", "profileManagement", "qualityAssessment", "adaptiveCalibration"],
      "properties": {
        "required": {
          "type": "boolean",
          "description": "Whether calibration is required"
        },
        "types": {
          "type": "array",
          "items": { "$ref": "#/definitions/CalibrationType" },
          "description": "Supported calibration types"
        },
        "pointOptions": {
          "type": "array",
          "items": { "type": "integer", "minimum": 1 },
          "description": "Available calibration point counts"
        },
        "defaultPoints": {
          "type": "integer",
          "minimum": 1,
          "description": "Default number of calibration points"
        },
        "autoCalibration": {
          "type": "boolean",
          "description": "Supports automatic calibration"
        },
        "profileManagement": {
          "type": "boolean",
          "description": "Supports saving/loading calibration profiles"
        },
        "qualityAssessment": {
          "type": "boolean",
          "description": "Provides calibration quality assessment"
        },
        "adaptiveCalibration": {
          "type": "boolean",
          "description": "Supports adaptive calibration for AAC"
        }
      }
    },
    "AccessibilityCapabilities": {
      "type": "object",
      "properties": {
        "dwellSelection": { "type": "boolean" },
        "blinkInput": { "type": "boolean" },
        "winkInput": { "type": "boolean" },
        "switchEmulation": { "type": "boolean" },
        "adaptiveDwellTime": { "type": "boolean" },
        "adaptiveTargetSize": { "type": "boolean" },
        "errorSmoothing": { "type": "boolean" },
        "tremorCompensation": { "type": "boolean" },
        "aacOptimizedMode": { "type": "boolean" },
        "longSessionOptimization": { "type": "boolean" },
        "fatigueDetection": { "type": "boolean" },
        "breakReminder": { "type": "boolean" }
      }
    },
    "ConnectionType": {
      "type": "string",
      "enum": ["usb", "usb_c", "bluetooth", "wifi", "ethernet", "hdmi"]
    },
    "ApiProtocol": {
      "type": "string",
      "enum": ["native_sdk", "wia_standard", "tcp_ip", "websocket", "rest_api", "webrtc"]
    },
    "ConnectivityCapabilities": {
      "type": "object",
      "required": ["connectionTypes", "apiProtocols", "multiClient", "remoteConnection", "mobileConnection"],
      "properties": {
        "connectionTypes": {
          "type": "array",
          "items": { "$ref": "#/definitions/ConnectionType" }
        },
        "apiProtocols": {
          "type": "array",
          "items": { "$ref": "#/definitions/ApiProtocol" }
        },
        "multiClient": {
          "type": "boolean",
          "description": "Supports multiple simultaneous clients"
        },
        "remoteConnection": {
          "type": "boolean",
          "description": "Supports remote network connection"
        },
        "mobileConnection": {
          "type": "boolean",
          "description": "Supports mobile device connection"
        }
      }
    },
    "FeatureFlag": {
      "type": "string",
      "enum": [
        "GAZE_POINT",
        "BINOCULAR",
        "HEAD_TRACKING",
        "GAZE_3D",
        "PUPIL_DIAMETER",
        "PUPIL_POSITION",
        "EYE_OPENNESS",
        "EYE_IMAGES",
        "FIXATION_DETECTION",
        "SACCADE_DETECTION",
        "BLINK_DETECTION",
        "CALIBRATION",
        "AUTO_CALIBRATION",
        "CALIBRATION_PROFILES",
        "DWELL_SELECTION",
        "BLINK_INPUT",
        "AAC_MODE",
        "TREMOR_COMPENSATION",
        "DEVICE_TIMESTAMP",
        "EXTERNAL_SYNC",
        "MULTI_MONITOR",
        "SCREEN_RECORDING",
        "HEATMAP_GENERATION"
      ]
    }
  },
  "examples": [
    {
      "device": {
        "deviceId": "tobii-pro-fusion-001",
        "vendor": "Tobii",
        "model": "Pro Fusion",
        "firmwareVersion": "2.1.0",
        "protocolVersion": "1.0.0",
        "deviceType": "screen_based"
      },
      "tracking": {
        "binocular": true,
        "headTracking": true,
        "gaze3D": true,
        "samplingRate": {
          "supported": [60, 120, 250],
          "default": 120
        },
        "accuracy": { "typical": 0.5 },
        "precision": { "typical": 0.1 },
        "latency": { "average": 3 },
        "operatingDistance": { "min": 50, "max": 80 },
        "trackingArea": { "horizontal": 30, "vertical": 25 }
      },
      "data": {
        "gazePoint": true,
        "eyeData": true,
        "pupilDiameter": true,
        "pupilPosition": true,
        "eyeOpenness": true,
        "eyeImages": true,
        "gazeOrigin3D": true,
        "gazeDirection3D": true,
        "builtInFixationDetection": false,
        "builtInSaccadeDetection": false,
        "builtInBlinkDetection": false,
        "deviceTimestamp": true,
        "systemTimestamp": true,
        "externalSync": true
      },
      "calibration": {
        "required": true,
        "types": ["standard", "quick"],
        "pointOptions": [5, 9],
        "defaultPoints": 5,
        "autoCalibration": false,
        "profileManagement": true,
        "qualityAssessment": true,
        "adaptiveCalibration": false
      },
      "connectivity": {
        "connectionTypes": ["usb_c"],
        "apiProtocols": ["native_sdk", "wia_standard"],
        "multiClient": true,
        "remoteConnection": false,
        "mobileConnection": false
      },
      "supportedFeatures": [
        "GAZE_POINT",
        "BINOCULAR",
        "HEAD_TRACKING",
        "GAZE_3D",
        "PUPIL_DIAMETER",
        "EYE_OPENNESS",
        "EYE_IMAGES",
        "CALIBRATION",
        "DEVICE_TIMESTAMP",
        "EXTERNAL_SYNC"
      ]
    }
  ]
}
