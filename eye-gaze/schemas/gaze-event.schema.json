{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.family/schemas/eye-gaze/gaze-event.schema.json",
  "title": "WIA Eye Gaze Event Schema",
  "description": "Standard schema for eye gaze events in WIA Eye Gaze Interoperability Protocol",
  "version": "1.0.0-draft",
  "type": "object",
  "required": ["type", "timestamp", "eventId"],
  "properties": {
    "type": {
      "type": "string",
      "description": "Event type",
      "enum": [
        "fixation_start",
        "fixation_update",
        "fixation_end",
        "saccade_start",
        "saccade_end",
        "smooth_pursuit_start",
        "smooth_pursuit_end",
        "blink_start",
        "blink_end",
        "blink",
        "wink_left",
        "wink_right",
        "double_blink",
        "dwell_start",
        "dwell_progress",
        "dwell_complete",
        "dwell_cancel",
        "gaze_enter",
        "gaze_leave",
        "calibration_start",
        "calibration_point",
        "calibration_end",
        "tracking_lost",
        "tracking_recovered",
        "device_connected",
        "device_disconnected"
      ]
    },
    "timestamp": {
      "type": "integer",
      "description": "Event timestamp (Unix timestamp in milliseconds)",
      "minimum": 0
    },
    "eventId": {
      "type": "string",
      "description": "Unique event identifier"
    },
    "duration": {
      "type": "integer",
      "description": "Event duration in milliseconds",
      "minimum": 0
    },
    "position": {
      "$ref": "#/definitions/Vector2D",
      "description": "Event position on screen"
    },
    "target": {
      "$ref": "#/definitions/GazeTarget",
      "description": "Target UI element"
    },
    "gazeData": {
      "type": "object",
      "description": "Related gaze point data"
    },
    "previousEventId": {
      "type": "string",
      "description": "Previous related event ID"
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "additionalProperties": true
    },
    "fixationId": {
      "type": "string",
      "description": "Fixation identifier (for fixation events)"
    },
    "centroid": {
      "$ref": "#/definitions/Vector2D",
      "description": "Fixation centroid (for fixation events)"
    },
    "radius": {
      "type": "number",
      "description": "Fixation radius (normalized)",
      "minimum": 0
    },
    "dispersion": {
      "type": "number",
      "description": "Fixation dispersion (degrees)",
      "minimum": 0
    },
    "saccadeId": {
      "type": "string",
      "description": "Saccade identifier (for saccade events)"
    },
    "startPosition": {
      "$ref": "#/definitions/Vector2D",
      "description": "Saccade start position"
    },
    "endPosition": {
      "$ref": "#/definitions/Vector2D",
      "description": "Saccade end position"
    },
    "amplitude": {
      "type": "number",
      "description": "Saccade amplitude (degrees)",
      "minimum": 0
    },
    "peakVelocity": {
      "type": "number",
      "description": "Saccade peak velocity (degrees/second)",
      "minimum": 0
    },
    "blinkId": {
      "type": "string",
      "description": "Blink identifier (for blink events)"
    },
    "eye": {
      "type": "string",
      "enum": ["left", "right", "both"],
      "description": "Which eye (for blink/wink events)"
    },
    "interval": {
      "type": "integer",
      "description": "Interval between blinks for double blink (ms)",
      "minimum": 0
    },
    "intentional": {
      "type": "boolean",
      "description": "Whether the blink/wink was intentional"
    },
    "dwellId": {
      "type": "string",
      "description": "Dwell identifier (for dwell events)"
    },
    "dwellThreshold": {
      "type": "integer",
      "description": "Dwell threshold in milliseconds",
      "minimum": 0
    },
    "elapsed": {
      "type": "integer",
      "description": "Elapsed time in milliseconds",
      "minimum": 0
    },
    "progress": {
      "type": "number",
      "description": "Dwell progress (0.0 - 1.0)",
      "minimum": 0,
      "maximum": 1
    },
    "cancelReason": {
      "type": "string",
      "enum": ["gaze_left", "timeout", "user_cancel"],
      "description": "Dwell cancel reason"
    },
    "calibrationId": {
      "type": "string",
      "description": "Calibration session ID"
    },
    "totalPoints": {
      "type": "integer",
      "description": "Total calibration points",
      "minimum": 1
    },
    "currentPoint": {
      "type": "integer",
      "description": "Current calibration point (1-based)",
      "minimum": 1
    },
    "pointPosition": {
      "$ref": "#/definitions/Vector2D",
      "description": "Calibration point position"
    },
    "result": {
      "$ref": "#/definitions/CalibrationResult",
      "description": "Calibration result"
    },
    "deviceId": {
      "type": "string",
      "description": "Device identifier (for system events)"
    },
    "status": {
      "$ref": "#/definitions/DeviceStatus",
      "description": "Device status"
    },
    "error": {
      "$ref": "#/definitions/ErrorInfo",
      "description": "Error information"
    }
  },
  "definitions": {
    "Vector2D": {
      "type": "object",
      "required": ["x", "y"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" }
      }
    },
    "BoundingBox": {
      "type": "object",
      "required": ["x", "y", "width", "height"],
      "properties": {
        "x": { "type": "number", "minimum": 0, "maximum": 1 },
        "y": { "type": "number", "minimum": 0, "maximum": 1 },
        "width": { "type": "number", "minimum": 0, "maximum": 1 },
        "height": { "type": "number", "minimum": 0, "maximum": 1 }
      }
    },
    "AccessibilityInfo": {
      "type": "object",
      "properties": {
        "role": { "type": "string" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "state": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "GazeTarget": {
      "type": "object",
      "required": ["elementId", "boundingBox", "semanticType"],
      "properties": {
        "elementId": {
          "type": "string",
          "description": "Unique element ID"
        },
        "boundingBox": {
          "$ref": "#/definitions/BoundingBox",
          "description": "Element bounding box"
        },
        "semanticType": {
          "type": "string",
          "enum": [
            "button",
            "link",
            "text",
            "input",
            "image",
            "video",
            "menu",
            "menuitem",
            "listitem",
            "scrollbar",
            "keyboard_key",
            "aac_symbol",
            "custom"
          ],
          "description": "Semantic type of the target"
        },
        "label": {
          "type": "string",
          "description": "Element label"
        },
        "accessibility": {
          "$ref": "#/definitions/AccessibilityInfo",
          "description": "Accessibility information"
        },
        "attributes": {
          "type": "object",
          "description": "Additional attributes",
          "additionalProperties": true
        }
      }
    },
    "CalibrationResult": {
      "type": "object",
      "required": ["success"],
      "properties": {
        "success": { "type": "boolean" },
        "averageAccuracy": { "type": "number", "minimum": 0 },
        "averagePrecision": { "type": "number", "minimum": 0 },
        "pointResults": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/PointCalibrationResult"
          }
        }
      }
    },
    "PointCalibrationResult": {
      "type": "object",
      "required": ["pointIndex", "position", "accuracy", "precision", "valid"],
      "properties": {
        "pointIndex": { "type": "integer", "minimum": 0 },
        "position": { "$ref": "#/definitions/Vector2D" },
        "accuracy": { "type": "number", "minimum": 0 },
        "precision": { "type": "number", "minimum": 0 },
        "valid": { "type": "boolean" }
      }
    },
    "DeviceStatus": {
      "type": "object",
      "required": ["connected", "tracking", "calibrated"],
      "properties": {
        "connected": { "type": "boolean" },
        "tracking": { "type": "boolean" },
        "calibrated": { "type": "boolean" },
        "batteryLevel": { "type": "integer", "minimum": 0, "maximum": 100 }
      }
    },
    "ErrorInfo": {
      "type": "object",
      "required": ["code", "message", "recoverable"],
      "properties": {
        "code": { "type": "string" },
        "message": { "type": "string" },
        "recoverable": { "type": "boolean" }
      }
    }
  },
  "examples": [
    {
      "type": "fixation_start",
      "timestamp": 1704067200000,
      "eventId": "evt_001",
      "fixationId": "fix_001",
      "centroid": { "x": 0.5, "y": 0.3 },
      "position": { "x": 0.5, "y": 0.3 }
    },
    {
      "type": "dwell_complete",
      "timestamp": 1704067201000,
      "eventId": "evt_002",
      "dwellId": "dwell_001",
      "target": {
        "elementId": "btn_ok",
        "boundingBox": { "x": 0.4, "y": 0.6, "width": 0.2, "height": 0.1 },
        "semanticType": "button",
        "label": "OK"
      },
      "dwellThreshold": 800,
      "elapsed": 820,
      "progress": 1.0
    }
  ]
}
