{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wia.live/schemas/security/protocol/response/v1.schema.json",
  "title": "WIA Security Protocol Response",
  "description": "Response message for WIA Security Communication Protocol",
  "allOf": [
    {
      "$ref": "message.schema.json"
    }
  ],
  "properties": {
    "message_type": {
      "const": "response"
    },
    "payload": {
      "type": "object",
      "required": ["content_type", "data"],
      "properties": {
        "content_type": {
          "type": "string"
        },
        "data": {
          "$ref": "#/$defs/ResponseData"
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "correlation_id": {
          "type": "string",
          "format": "uuid",
          "description": "ID of the original request"
        },
        "processing_time_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Time taken to process request"
        }
      }
    }
  },
  "$defs": {
    "ResponseStatus": {
      "type": "string",
      "enum": ["success", "error", "partial", "pending"],
      "description": "Response status"
    },
    "ResponseData": {
      "type": "object",
      "required": ["status"],
      "properties": {
        "status": {
          "$ref": "#/$defs/ResponseStatus"
        },
        "result": {
          "type": "object",
          "description": "Response result data"
        },
        "error": {
          "$ref": "#/$defs/ErrorInfo"
        }
      }
    },
    "ErrorCode": {
      "type": "string",
      "pattern": "^E[1-5][0-9]{3}$",
      "description": "Error code (E1xxx-E5xxx)"
    },
    "ErrorInfo": {
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": {
          "$ref": "#/$defs/ErrorCode"
        },
        "name": {
          "type": "string",
          "description": "Error name"
        },
        "message": {
          "type": "string",
          "description": "Human-readable error message"
        },
        "details": {
          "type": "object",
          "description": "Additional error details"
        },
        "retry_after": {
          "type": "integer",
          "description": "Seconds to wait before retrying"
        },
        "help_url": {
          "type": "string",
          "format": "uri",
          "description": "URL for more information"
        }
      }
    },
    "AccessDecisionResponse": {
      "type": "object",
      "required": ["decision", "decision_id"],
      "properties": {
        "decision": {
          "type": "string",
          "enum": ["permit", "deny", "indeterminate", "not_applicable"]
        },
        "decision_id": {
          "type": "string",
          "format": "uuid"
        },
        "conditions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/AccessCondition"
          }
        },
        "obligations": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/AccessObligation"
          }
        },
        "valid_from": {
          "type": "string",
          "format": "date-time"
        },
        "valid_until": {
          "type": "string",
          "format": "date-time"
        },
        "session_token": {
          "type": "string",
          "description": "Encrypted access token"
        }
      }
    },
    "AccessCondition": {
      "type": "object",
      "required": ["type", "constraint", "value"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["time_limit", "continuous_auth", "data_limit", "location_limit", "custom"]
        },
        "constraint": {
          "type": "string"
        },
        "value": {}
      }
    },
    "AccessObligation": {
      "type": "object",
      "required": ["type", "action"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["logging", "alerting", "masking", "encryption", "notification", "custom"]
        },
        "action": {
          "type": "string"
        },
        "target": {
          "type": "string"
        },
        "condition": {
          "type": "string"
        },
        "parameters": {
          "type": "object"
        }
      }
    },
    "ScanResponse": {
      "type": "object",
      "required": ["scan_id", "status"],
      "properties": {
        "scan_id": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["started", "running", "completed", "failed", "cancelled"]
        },
        "tracking_id": {
          "type": "string"
        },
        "estimated_completion": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "SubscriptionResponse": {
      "type": "object",
      "required": ["subscription_id", "status"],
      "properties": {
        "subscription_id": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["active", "paused", "cancelled"]
        },
        "channels": {
          "type": "array",
          "items": { "type": "string" }
        },
        "expires_at": {
          "type": "string",
          "format": "date-time"
        }
      }
    }
  }
}
