{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.live/security/v1/endpoint-event.schema.json",
  "title": "WIA Endpoint Event",
  "description": "Endpoint Event type schema",
  "allOf": [
    { "$ref": "wia-security-v1.schema.json" }
  ],
  "properties": {
    "type": {
      "const": "endpoint_event"
    },
    "data": {
      "$ref": "#/definitions/EndpointEventData"
    }
  },
  "definitions": {
    "EndpointEventData": {
      "type": "object",
      "required": ["event_type", "host"],
      "properties": {
        "event_type": {
          "type": "string",
          "enum": [
            "process_creation",
            "process_termination",
            "file_create",
            "file_modify",
            "file_delete",
            "registry_create",
            "registry_modify",
            "registry_delete",
            "network_connection",
            "dll_load",
            "driver_load",
            "service_install"
          ],
          "description": "Endpoint event type"
        },
        "host": {
          "type": "object",
          "required": ["hostname"],
          "properties": {
            "hostname": { "type": "string" },
            "ip": {
              "type": "array",
              "items": { "type": "string" }
            },
            "mac": {
              "type": "array",
              "items": { "type": "string" }
            },
            "os": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "enum": ["Windows", "Linux", "macOS"]
                },
                "version": { "type": "string" },
                "build": { "type": "string" }
              }
            },
            "domain": { "type": "string" },
            "agent_id": { "type": "string" }
          }
        },
        "process": {
          "type": "object",
          "properties": {
            "pid": { "type": "integer" },
            "ppid": { "type": "integer" },
            "name": { "type": "string" },
            "path": { "type": "string" },
            "command_line": { "type": "string" },
            "user": { "type": "string" },
            "integrity_level": {
              "type": "string",
              "enum": ["system", "high", "medium", "low"]
            },
            "start_time": {
              "type": "string",
              "format": "date-time"
            },
            "hash": {
              "type": "object",
              "properties": {
                "md5": { "type": "string" },
                "sha1": { "type": "string" },
                "sha256": { "type": "string" }
              }
            },
            "signature": {
              "type": "object",
              "properties": {
                "signed": { "type": "boolean" },
                "valid": { "type": "boolean" },
                "issuer": { "type": "string" },
                "subject": { "type": "string" }
              }
            },
            "parent": {
              "type": "object",
              "properties": {
                "pid": { "type": "integer" },
                "name": { "type": "string" },
                "path": { "type": "string" },
                "command_line": { "type": "string" }
              }
            }
          }
        },
        "file": {
          "type": "object",
          "properties": {
            "path": { "type": "string" },
            "name": { "type": "string" },
            "extension": { "type": "string" },
            "size": { "type": "integer" },
            "hash": {
              "type": "object",
              "properties": {
                "md5": { "type": "string" },
                "sha1": { "type": "string" },
                "sha256": { "type": "string" }
              }
            },
            "created": {
              "type": "string",
              "format": "date-time"
            },
            "modified": {
              "type": "string",
              "format": "date-time"
            },
            "accessed": {
              "type": "string",
              "format": "date-time"
            },
            "owner": { "type": "string" },
            "permissions": { "type": "string" }
          }
        },
        "registry": {
          "type": "object",
          "properties": {
            "key": { "type": "string" },
            "value_name": { "type": "string" },
            "value_data": { "type": "string" },
            "value_type": {
              "type": "string",
              "enum": ["REG_SZ", "REG_DWORD", "REG_QWORD", "REG_BINARY", "REG_MULTI_SZ", "REG_EXPAND_SZ"]
            },
            "previous_data": { "type": "string" }
          }
        },
        "network_connection": {
          "type": "object",
          "properties": {
            "direction": {
              "type": "string",
              "enum": ["inbound", "outbound"]
            },
            "protocol": {
              "type": "string",
              "enum": ["TCP", "UDP"]
            },
            "local_ip": { "type": "string" },
            "local_port": { "type": "integer" },
            "remote_ip": { "type": "string" },
            "remote_port": { "type": "integer" },
            "state": { "type": "string" }
          }
        },
        "dll": {
          "type": "object",
          "properties": {
            "path": { "type": "string" },
            "name": { "type": "string" },
            "hash": {
              "type": "object",
              "properties": {
                "md5": { "type": "string" },
                "sha1": { "type": "string" },
                "sha256": { "type": "string" }
              }
            },
            "signed": { "type": "boolean" }
          }
        }
      }
    }
  }
}
