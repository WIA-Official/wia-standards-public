{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.org/schemas/medical/alarm-system.schema.json",
  "title": "WIA Medical Device Alarm System",
  "description": "Multi-sensory alarm system schema for accessible medical devices",
  "type": "object",
  "required": ["alarm_system_id", "alarm_categories", "output_modalities"],
  "properties": {
    "alarm_system_id": {
      "type": "string",
      "description": "Unique identifier for the alarm system configuration"
    },
    "alarm_system_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "device_id": {
      "type": "string",
      "description": "Reference to the medical device using this alarm system"
    },
    "alarm_categories": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/AlarmCategory"
      },
      "minItems": 1
    },
    "output_modalities": {
      "$ref": "#/definitions/OutputModalities"
    },
    "accessibility_settings": {
      "$ref": "#/definitions/AlarmAccessibilitySettings"
    },
    "escalation": {
      "$ref": "#/definitions/EscalationConfig"
    },
    "user_customization": {
      "$ref": "#/definitions/UserCustomization"
    }
  },
  "definitions": {
    "AlarmCategory": {
      "type": "object",
      "required": ["id", "name", "priority", "meaning", "recommended_action"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique alarm identifier"
        },
        "name": {
          "type": "string",
          "description": "Human-readable alarm name"
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "description": "Alarm priority level"
        },
        "meaning": {
          "type": "string",
          "description": "Description of what this alarm indicates"
        },
        "recommended_action": {
          "type": "string",
          "description": "Suggested user response to the alarm"
        },
        "medical_urgency": {
          "type": "string",
          "enum": ["informational", "attention_required", "urgent", "emergency"],
          "description": "Medical urgency classification"
        },
        "visual_config": {
          "$ref": "#/definitions/VisualAlarmConfig"
        },
        "auditory_config": {
          "$ref": "#/definitions/AuditoryAlarmConfig"
        },
        "haptic_config": {
          "$ref": "#/definitions/HapticAlarmConfig"
        }
      }
    },
    "VisualAlarmConfig": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "color": {
          "type": "string",
          "description": "Primary color (hex or named)"
        },
        "secondary_color": {
          "type": "string",
          "description": "Secondary/contrast color for accessibility"
        },
        "pattern": {
          "type": "string",
          "enum": ["solid", "flashing", "pulsing", "scrolling"]
        },
        "flash_rate_hz": {
          "type": "number",
          "minimum": 0.5,
          "maximum": 3,
          "description": "Flash rate in Hz (avoid 3+ Hz for photosensitivity)"
        },
        "icon": {
          "type": "string",
          "description": "Icon identifier or path"
        },
        "text": {
          "type": "string",
          "description": "Text message to display"
        },
        "text_simple": {
          "type": "string",
          "description": "Simplified text for cognitive accessibility"
        },
        "led_indicator": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "color": { "type": "string" },
            "pattern": { "type": "string" }
          }
        },
        "screen_flash": {
          "type": "boolean",
          "description": "Whether to flash entire screen"
        },
        "high_contrast_mode": {
          "type": "boolean",
          "description": "Force high contrast display during alarm"
        }
      }
    },
    "AuditoryAlarmConfig": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "tone": {
          "type": "object",
          "properties": {
            "frequency_hz": {
              "type": "number",
              "minimum": 100,
              "maximum": 8000
            },
            "secondary_frequency_hz": {
              "type": "number",
              "description": "For two-tone alarms"
            },
            "duration_ms": {
              "type": "integer",
              "minimum": 50
            },
            "pattern": {
              "type": "string",
              "enum": ["continuous", "intermittent", "escalating", "pulsing"]
            },
            "pulse_on_ms": {
              "type": "integer"
            },
            "pulse_off_ms": {
              "type": "integer"
            }
          }
        },
        "volume_db": {
          "type": "number",
          "minimum": 30,
          "maximum": 100,
          "description": "Volume in decibels"
        },
        "minimum_volume_db": {
          "type": "number",
          "description": "Minimum allowed volume for critical alarms"
        },
        "voice_announcement": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "text": {
              "type": "string",
              "description": "Text to be spoken"
            },
            "text_simple": {
              "type": "string",
              "description": "Simplified announcement"
            },
            "repeat_count": {
              "type": "integer",
              "minimum": 1
            },
            "repeat_interval_ms": {
              "type": "integer"
            },
            "language": {
              "type": "string",
              "description": "BCP 47 language tag"
            },
            "voice_id": {
              "type": "string",
              "description": "Specific voice/persona to use"
            },
            "speech_rate": {
              "type": "number",
              "minimum": 0.5,
              "maximum": 2.0,
              "default": 1.0
            }
          }
        },
        "hearing_aid_optimized": {
          "type": "boolean",
          "description": "Optimized for hearing aid compatibility"
        },
        "frequency_shift": {
          "type": "object",
          "description": "Frequency shifting for hearing loss compensation",
          "properties": {
            "enabled": { "type": "boolean" },
            "shift_low_frequencies": { "type": "boolean" },
            "shift_high_frequencies": { "type": "boolean" },
            "target_frequency_hz": { "type": "number" }
          }
        }
      }
    },
    "HapticAlarmConfig": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "pattern_id": {
          "type": "string",
          "description": "WIA standard haptic pattern identifier"
        },
        "custom_pattern": {
          "type": "array",
          "description": "Custom vibration pattern [duration, pause, duration, ...]",
          "items": { "type": "integer" }
        },
        "intensity": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Haptic intensity 0.0-1.0"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 50
        },
        "repeat_count": {
          "type": "integer",
          "minimum": 1
        },
        "repeat_interval_ms": {
          "type": "integer"
        },
        "wia_haptic_device": {
          "type": "object",
          "description": "WIA exoskeleton/haptic device integration",
          "properties": {
            "enabled": { "type": "boolean" },
            "target_body_location": {
              "type": "string",
              "enum": ["wrist_left", "wrist_right", "arm_left", "arm_right", "torso", "custom"]
            },
            "custom_location": { "type": "string" },
            "intensity_override": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        }
      }
    },
    "OutputModalities": {
      "type": "object",
      "properties": {
        "visual": {
          "type": "object",
          "properties": {
            "supported": { "type": "boolean" },
            "required_for_critical": { "type": "boolean" },
            "default_enabled": { "type": "boolean" }
          }
        },
        "auditory": {
          "type": "object",
          "properties": {
            "supported": { "type": "boolean" },
            "required_for_critical": { "type": "boolean" },
            "default_enabled": { "type": "boolean" }
          }
        },
        "haptic": {
          "type": "object",
          "properties": {
            "supported": { "type": "boolean" },
            "required_for_critical": { "type": "boolean" },
            "default_enabled": { "type": "boolean" }
          }
        }
      }
    },
    "AlarmAccessibilitySettings": {
      "type": "object",
      "properties": {
        "allow_single_modality": {
          "type": "boolean",
          "description": "Allow users to use only one output modality"
        },
        "minimum_modalities_critical": {
          "type": "integer",
          "minimum": 1,
          "maximum": 3,
          "description": "Minimum modalities required for critical alarms"
        },
        "minimum_modalities_other": {
          "type": "integer",
          "minimum": 1,
          "maximum": 3
        },
        "user_can_disable": {
          "type": "object",
          "properties": {
            "low_priority": { "type": "boolean" },
            "medium_priority": { "type": "boolean" },
            "high_priority": { "type": "boolean" },
            "critical": { "type": "boolean", "default": false }
          }
        },
        "snooze_allowed": {
          "type": "object",
          "properties": {
            "low_priority": { "type": "boolean" },
            "medium_priority": { "type": "boolean" },
            "high_priority": { "type": "boolean" },
            "critical": { "type": "boolean", "default": false }
          }
        },
        "snooze_duration_options_minutes": {
          "type": "array",
          "items": { "type": "integer" }
        },
        "cognitive_support": {
          "type": "object",
          "properties": {
            "simplified_messages": { "type": "boolean" },
            "step_by_step_guidance": { "type": "boolean" },
            "confirmation_required": { "type": "boolean" },
            "caregiver_notification": { "type": "boolean" }
          }
        }
      }
    },
    "EscalationConfig": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 5,
          "description": "Time before escalation begins"
        },
        "steps": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/EscalationStep"
          }
        },
        "emergency_contact": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "contacts": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "phone": { "type": "string" },
                  "relationship": { "type": "string" },
                  "notification_methods": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": ["sms", "call", "app_notification", "email"]
                    }
                  }
                }
              }
            }
          }
        },
        "healthcare_provider_alert": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "provider_id": { "type": "string" },
            "alert_threshold": {
              "type": "string",
              "enum": ["high", "critical"]
            }
          }
        },
        "emergency_services": {
          "type": "object",
          "properties": {
            "auto_call_enabled": { "type": "boolean", "default": false },
            "auto_call_delay_seconds": { "type": "integer" },
            "requires_confirmation": { "type": "boolean", "default": true }
          }
        }
      }
    },
    "EscalationStep": {
      "type": "object",
      "required": ["delay_seconds", "action"],
      "properties": {
        "delay_seconds": {
          "type": "integer",
          "minimum": 0
        },
        "action": {
          "type": "string",
          "enum": [
            "repeat",
            "increase_volume",
            "increase_intensity",
            "add_modality",
            "notify_caregiver",
            "notify_provider",
            "emergency_call"
          ]
        },
        "parameters": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "UserCustomization": {
      "type": "object",
      "description": "User-specific alarm customizations",
      "properties": {
        "global_volume_multiplier": {
          "type": "number",
          "minimum": 0.1,
          "maximum": 2.0,
          "default": 1.0
        },
        "global_haptic_multiplier": {
          "type": "number",
          "minimum": 0.1,
          "maximum": 2.0,
          "default": 1.0
        },
        "preferred_voice": {
          "type": "string"
        },
        "preferred_language": {
          "type": "string"
        },
        "quiet_hours": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "start_time": { "type": "string", "format": "time" },
            "end_time": { "type": "string", "format": "time" },
            "reduce_non_critical": { "type": "boolean" },
            "critical_alarms_normal": { "type": "boolean", "default": true }
          }
        },
        "alarm_overrides": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "alarm_id": { "type": "string" },
              "visual_enabled": { "type": "boolean" },
              "auditory_enabled": { "type": "boolean" },
              "haptic_enabled": { "type": "boolean" },
              "volume_override": { "type": "number" },
              "haptic_intensity_override": { "type": "number" }
            }
          }
        }
      }
    }
  }
}
