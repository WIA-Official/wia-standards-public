{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia-standards.org/carebot/safety.schema.json",
  "title": "SafetyEvent",
  "description": "Safety event detection and response",
  "type": "object",
  "required": ["event_id", "timestamp", "event_type", "severity"],
  "properties": {
    "event_id": {
      "type": "string",
      "pattern": "^safety-[0-9]+-[0-9]+$"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "recipient_id": {
      "type": "string"
    },
    "device_id": {
      "type": "string"
    },
    "event_type": {
      "type": "string",
      "enum": [
        "fall_detected",
        "wandering_detected",
        "abnormal_activity",
        "no_movement_extended",
        "sos_button",
        "medication_missed",
        "vital_sign_alert",
        "environmental_hazard"
      ]
    },
    "severity": {
      "type": "string",
      "enum": ["info", "warning", "urgent", "critical", "emergency"]
    },
    "location": {
      "type": "object",
      "properties": {
        "room": { "type": "string" },
        "coordinates": {
          "type": "object",
          "properties": {
            "x": { "type": "number" },
            "y": { "type": "number" }
          }
        },
        "confidence": { "type": "number" }
      }
    },
    "detection": {
      "type": "object",
      "properties": {
        "method": { "type": "string" },
        "confidence": { "type": "number" },
        "supporting_evidence": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "recipient_response": {
      "type": "object",
      "properties": {
        "verbal_response": { "type": "boolean" },
        "movement_detected": { "type": "boolean" },
        "button_press": { "type": "boolean" },
        "response_latency_seconds": { "type": ["number", "null"] }
      }
    },
    "automated_actions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "action": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" },
          "message": { "type": "string" },
          "response_received": { "type": "boolean" },
          "contacts_notified": { "type": "array", "items": { "type": "string" } },
          "notification_method": { "type": "string" },
          "service": { "type": "string" },
          "call_initiated": { "type": "boolean" }
        }
      }
    },
    "resolution": {
      "type": "object",
      "properties": {
        "status": { "type": "string", "enum": ["pending", "in_progress", "resolved", "escalated"] },
        "resolved_at": { "type": "string", "format": "date-time" },
        "resolved_by": { "type": "string" },
        "outcome": { "type": "string" },
        "follow_up_required": { "type": "boolean" },
        "notes": { "type": "string" }
      }
    }
  }
}
