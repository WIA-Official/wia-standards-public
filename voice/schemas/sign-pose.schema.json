{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wia-standards.org/voice/schemas/sign-pose.schema.json",
  "title": "SignPoseSequence",
  "description": "3D avatar pose sequence for sign language animation",
  "type": "object",
  "required": ["gloss_id", "pose_sequence_id", "timestamp", "frame_rate", "total_frames", "duration_ms", "skeleton", "frames"],
  "properties": {
    "gloss_id": {
      "type": "string",
      "description": "Reference to source gloss sequence"
    },
    "pose_sequence_id": {
      "type": "string",
      "description": "Unique identifier for this pose sequence"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "frame_rate": {
      "type": "integer",
      "enum": [24, 25, 30, 50, 60],
      "description": "Frames per second"
    },
    "total_frames": {
      "type": "integer",
      "minimum": 1
    },
    "duration_ms": {
      "type": "number",
      "minimum": 0
    },
    "skeleton": {
      "$ref": "#/$defs/SkeletonDefinition"
    },
    "frames": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/PoseFrame"
      }
    },
    "blend_shapes": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/BlendShapeTrack"
      }
    }
  },
  "$defs": {
    "SkeletonDefinition": {
      "type": "object",
      "required": ["standard", "joints"],
      "properties": {
        "standard": {
          "type": "string",
          "enum": ["mediapipe_holistic", "openpose", "wia_sign_skeleton", "custom"]
        },
        "joints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/JointDefinition"
          }
        }
      }
    },
    "JointDefinition": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "integer",
          "minimum": 0
        },
        "name": {
          "type": "string"
        },
        "parent_id": {
          "type": ["integer", "null"]
        }
      }
    },
    "PoseFrame": {
      "type": "object",
      "required": ["frame_index", "timestamp_ms", "joints"],
      "properties": {
        "frame_index": {
          "type": "integer",
          "minimum": 0
        },
        "timestamp_ms": {
          "type": "number",
          "minimum": 0
        },
        "joints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/JointPose"
          }
        },
        "left_hand": {
          "$ref": "#/$defs/HandPose"
        },
        "right_hand": {
          "$ref": "#/$defs/HandPose"
        },
        "face": {
          "$ref": "#/$defs/FacePose"
        }
      }
    },
    "JointPose": {
      "type": "object",
      "required": ["joint_id", "position", "rotation"],
      "properties": {
        "joint_id": {
          "type": "integer"
        },
        "position": {
          "$ref": "#/$defs/Vector3"
        },
        "rotation": {
          "$ref": "#/$defs/Quaternion"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "Vector3": {
      "type": "object",
      "required": ["x", "y", "z"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      }
    },
    "Quaternion": {
      "type": "object",
      "required": ["x", "y", "z", "w"],
      "properties": {
        "x": { "type": "number", "minimum": -1, "maximum": 1 },
        "y": { "type": "number", "minimum": -1, "maximum": 1 },
        "z": { "type": "number", "minimum": -1, "maximum": 1 },
        "w": { "type": "number", "minimum": -1, "maximum": 1 }
      }
    },
    "HandPose": {
      "type": "object",
      "required": ["landmarks"],
      "properties": {
        "landmarks": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/HandLandmark"
          },
          "minItems": 21,
          "maxItems": 21
        }
      }
    },
    "HandLandmark": {
      "type": "object",
      "required": ["id", "name", "position"],
      "properties": {
        "id": {
          "type": "integer",
          "minimum": 0,
          "maximum": 20
        },
        "name": {
          "type": "string",
          "enum": [
            "wrist",
            "thumb_cmc", "thumb_mcp", "thumb_ip", "thumb_tip",
            "index_mcp", "index_pip", "index_dip", "index_tip",
            "middle_mcp", "middle_pip", "middle_dip", "middle_tip",
            "ring_mcp", "ring_pip", "ring_dip", "ring_tip",
            "pinky_mcp", "pinky_pip", "pinky_dip", "pinky_tip"
          ]
        },
        "position": {
          "$ref": "#/$defs/Vector3"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "FacePose": {
      "type": "object",
      "required": ["landmarks"],
      "properties": {
        "landmarks": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/FaceLandmark"
          }
        },
        "blend_weights": {
          "type": "object",
          "additionalProperties": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          }
        }
      }
    },
    "FaceLandmark": {
      "type": "object",
      "required": ["id", "position"],
      "properties": {
        "id": {
          "type": "integer"
        },
        "position": {
          "$ref": "#/$defs/Vector3"
        }
      }
    },
    "BlendShapeTrack": {
      "type": "object",
      "required": ["name", "keyframes"],
      "properties": {
        "name": {
          "type": "string"
        },
        "keyframes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/BlendShapeKeyframe"
          }
        }
      }
    },
    "BlendShapeKeyframe": {
      "type": "object",
      "required": ["timestamp_ms", "value"],
      "properties": {
        "timestamp_ms": {
          "type": "number",
          "minimum": 0
        },
        "value": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    }
  }
}
