{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.live/nano/v1/schema.json",
  "title": "WIA Nano Base Message",
  "description": "Base schema for all WIA Nano system messages",
  "type": "object",
  "required": ["$schema", "version", "system_type", "device", "timestamp", "sequence", "data"],
  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri",
      "description": "JSON Schema URL"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Standard version (semver)"
    },
    "system_type": {
      "type": "string",
      "enum": [
        "molecular_assembler",
        "nano_machine",
        "molecular_memory",
        "nanomedicine",
        "nanorobot",
        "nanosensor",
        "custom"
      ],
      "description": "Type of nano system"
    },
    "device": {
      "$ref": "#/definitions/Device"
    },
    "timestamp": {
      "$ref": "#/definitions/Timestamp"
    },
    "sequence": {
      "type": "integer",
      "minimum": 0,
      "description": "Message sequence number"
    },
    "environment": {
      "$ref": "#/definitions/Environment"
    },
    "scale": {
      "$ref": "#/definitions/Scale"
    },
    "data": {
      "type": "object",
      "description": "System-specific data"
    },
    "meta": {
      "$ref": "#/definitions/Metadata"
    }
  },
  "definitions": {
    "Device": {
      "type": "object",
      "required": ["manufacturer", "model"],
      "properties": {
        "manufacturer": {
          "type": "string",
          "minLength": 1
        },
        "model": {
          "type": "string",
          "minLength": 1
        },
        "serial": {
          "type": "string"
        },
        "firmware": {
          "type": "string"
        }
      }
    },
    "Timestamp": {
      "type": "object",
      "required": ["iso8601"],
      "properties": {
        "iso8601": {
          "type": "string",
          "format": "date-time"
        },
        "unix_ms": {
          "type": "integer",
          "minimum": 0
        },
        "unix_ns": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "Environment": {
      "type": "object",
      "properties": {
        "temperature_k": {
          "type": "number",
          "minimum": 0,
          "description": "Temperature in Kelvin"
        },
        "pressure_pa": {
          "type": "number",
          "minimum": 0,
          "description": "Pressure in Pascals"
        },
        "medium": {
          "type": "string",
          "enum": ["vacuum", "air", "water", "saline", "blood", "cytoplasm", "custom"]
        },
        "ph": {
          "type": "number",
          "minimum": 0,
          "maximum": 14
        },
        "ionic_strength_m": {
          "type": "number",
          "minimum": 0,
          "description": "Ionic strength in mol/L"
        },
        "viscosity_pa_s": {
          "type": "number",
          "minimum": 0,
          "description": "Viscosity in PaÂ·s"
        }
      }
    },
    "Scale": {
      "type": "object",
      "properties": {
        "length_unit": {
          "type": "string",
          "enum": ["picometer", "angstrom", "nanometer", "micrometer"],
          "default": "nanometer"
        },
        "time_unit": {
          "type": "string",
          "enum": ["nanosecond", "microsecond", "millisecond", "second"],
          "default": "nanosecond"
        },
        "mass_unit": {
          "type": "string",
          "enum": ["dalton", "femtogram", "picogram"],
          "default": "dalton"
        }
      }
    },
    "Metadata": {
      "type": "object",
      "properties": {
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "error_margin": {
          "type": "number",
          "minimum": 0
        },
        "calibration_id": {
          "type": "string"
        },
        "experiment_id": {
          "type": "string"
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "Position3D": {
      "type": "object",
      "required": ["x", "y", "z"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      }
    },
    "Quaternion": {
      "type": "object",
      "required": ["w", "x", "y", "z"],
      "properties": {
        "w": { "type": "number" },
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      }
    }
  }
}
