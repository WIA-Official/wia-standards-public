<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 6: Phase 3 - Streaming Protocol - WIA Emotion AI Standard Ebook</title>
</head>
<body>

<p><a href="index.html">ğŸ’— WIA Emotion AI Standard Ebook</a> | Chapter 6 of 8</p>

<hr>

<h1>ğŸ’— Chapter 6: Phase 3 - Streaming Protocol</h1>

<blockquote>
<p><strong>Hongik Ingan (å¼˜ç›Šäººé–“)</strong></p>
<p>"Benefit All Humanity"</p>
<p>Real-time emotion streaming enables continuous affective computing for applications requiring immediate feedback and temporal analysis.</p>
</blockquote>

<hr>

<h2>6.1 Overview</h2>

<h3>6.1.1 Purpose</h3>

<p>Phase 3 defines the real-time streaming protocol for continuous emotion analysis. This is essential for applications like:</p>

<ul>
    <li>Live video call emotion monitoring</li>
    <li>Driver drowsiness detection</li>
    <li>Gaming and VR experiences</li>
    <li>Mental health session monitoring</li>
    <li>Customer service sentiment tracking</li>
</ul>

<h3>6.1.2 Protocol Options</h3>

<table border="1" cellpadding="10">
    <thead>
        <tr>
            <th>Protocol</th>
            <th>Use Case</th>
            <th>Latency</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>WebSocket</td>
            <td>Web/mobile apps, bidirectional</td>
            <td>&lt;100ms</td>
        </tr>
        <tr>
            <td>gRPC</td>
            <td>Server-to-server, high performance</td>
            <td>&lt;50ms</td>
        </tr>
        <tr>
            <td>MQTT</td>
            <td>IoT devices, low bandwidth</td>
            <td>&lt;200ms</td>
        </tr>
        <tr>
            <td>Server-Sent Events</td>
            <td>One-way streaming</td>
            <td>&lt;150ms</td>
        </tr>
    </tbody>
</table>

<hr>

<h2>6.2 WebSocket Protocol</h2>

<h3>6.2.1 Connection</h3>

<pre>
Endpoint: wss://stream.wiastandards.com/emotion-ai/v1/stream

Connection Request:
GET /emotion-ai/v1/stream HTTP/1.1
Host: stream.wiastandards.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13
X-WIA-API-Key: your_api_key

Connection Response:
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
</pre>

<h3>6.2.2 Message Types</h3>

<table border="1" cellpadding="10">
    <thead>
        <tr>
            <th>Type</th>
            <th>Direction</th>
            <th>Purpose</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>config</td>
            <td>Client â†’ Server</td>
            <td>Configure stream parameters</td>
        </tr>
        <tr>
            <td>frame</td>
            <td>Client â†’ Server</td>
            <td>Send video/audio frame</td>
        </tr>
        <tr>
            <td>result</td>
            <td>Server â†’ Client</td>
            <td>Emotion analysis result</td>
        </tr>
        <tr>
            <td>error</td>
            <td>Server â†’ Client</td>
            <td>Error notification</td>
        </tr>
        <tr>
            <td>ping/pong</td>
            <td>Bidirectional</td>
            <td>Keep-alive</td>
        </tr>
    </tbody>
</table>

<h3>6.2.3 Configuration Message</h3>

<pre>
{
    "type": "config",
    "stream_id": "stream_abc123",
    "modalities": ["facial", "voice"],

    "facial": {
        "frame_rate": 30,
        "resolution": "720p",
        "encoding": "jpeg",
        "return_action_units": true
    },

    "voice": {
        "sample_rate": 16000,
        "encoding": "LINEAR16",
        "language": "en-US"
    },

    "output": {
        "rate": "per_frame",  // or "per_second", "on_change"
        "include_dimensions": true,
        "include_raw_scores": false
    }
}
</pre>

<h3>6.2.4 Frame Message (Binary)</h3>

<pre>
Binary Frame Format:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (16 bytes)                           â”‚
â”‚   - Magic: 0x57494145 ("WIAE")              â”‚
â”‚   - Version: 1                              â”‚
â”‚   - Modality: 1=facial, 2=voice, 3=both     â”‚
â”‚   - Timestamp: 8 bytes (ms since epoch)     â”‚
â”‚   - Length: 4 bytes                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Payload (variable length)                   â”‚
â”‚   - JPEG image data or PCM audio            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>

<h3>6.2.5 Result Message</h3>

<pre>
{
    "type": "result",
    "stream_id": "stream_abc123",
    "frame_number": 1542,
    "timestamp": "2025-12-19T10:30:15.123Z",
    "latency_ms": 42,

    "emotions": {
        "primary": { "label": "happiness", "confidence": 0.85 },
        "change_detected": false
    },

    "dimensions": {
        "valence": 0.72,
        "arousal": 0.48
    },

    "action_units": [
        { "au": "AU6", "intensity": 0.78 },
        { "au": "AU12", "intensity": 0.82 }
    ],

    "face": {
        "detected": true,
        "tracking_id": "face_001",
        "bbox": { "x": 120, "y": 80, "width": 200, "height": 250 }
    }
}
</pre>

<hr>

<h2>6.3 Frame Rate and Latency</h2>

<h3>6.3.1 Frame Rate Requirements</h3>

<table border="1" cellpadding="10">
    <thead>
        <tr>
            <th>Use Case</th>
            <th>Minimum FPS</th>
            <th>Recommended FPS</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Video calls</td>
            <td>15</td>
            <td>30</td>
        </tr>
        <tr>
            <td>Gaming/VR</td>
            <td>30</td>
            <td>60</td>
        </tr>
        <tr>
            <td>Driver monitoring</td>
            <td>30</td>
            <td>60</td>
        </tr>
        <tr>
            <td>Healthcare</td>
            <td>10</td>
            <td>30</td>
        </tr>
        <tr>
            <td>Retail analytics</td>
            <td>5</td>
            <td>15</td>
        </tr>
    </tbody>
</table>

<h3>6.3.2 Latency Targets</h3>

<table border="1" cellpadding="10">
    <thead>
        <tr>
            <th>Component</th>
            <th>Target</th>
            <th>Maximum</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Frame capture</td>
            <td>&lt;10ms</td>
            <td>20ms</td>
        </tr>
        <tr>
            <td>Network transfer</td>
            <td>&lt;30ms</td>
            <td>50ms</td>
        </tr>
        <tr>
            <td>Face detection</td>
            <td>&lt;15ms</td>
            <td>30ms</td>
        </tr>
        <tr>
            <td>Emotion classification</td>
            <td>&lt;20ms</td>
            <td>40ms</td>
        </tr>
        <tr>
            <td>Response delivery</td>
            <td>&lt;10ms</td>
            <td>20ms</td>
        </tr>
        <tr>
            <td><strong>Total (end-to-end)</strong></td>
            <td><strong>&lt;85ms</strong></td>
            <td><strong>160ms</strong></td>
        </tr>
    </tbody>
</table>

<h3>6.3.3 Output Rate Modes</h3>

<pre>
"per_frame":
  - Result for every input frame
  - Highest bandwidth, lowest latency
  - Best for gaming, VR

"per_second":
  - Aggregated result every second
  - Lower bandwidth
  - Best for analytics, monitoring

"on_change":
  - Result only when emotion changes
  - Lowest bandwidth
  - Best for event-driven applications

"threshold":
  - Result when confidence exceeds threshold
  - Configurable sensitivity
  - Best for alert systems
</pre>

<hr>

<h2>6.4 Event-Based Streaming</h2>

<h3>6.4.1 Emotion Events</h3>

<pre>
{
    "type": "event",
    "event_type": "emotion_change",
    "stream_id": "stream_abc123",
    "timestamp": "2025-12-19T10:30:15.123Z",

    "previous_emotion": {
        "label": "neutral",
        "confidence": 0.75
    },

    "current_emotion": {
        "label": "happiness",
        "confidence": 0.82
    },

    "transition_duration_ms": 450,
    "trigger": "gradual"  // or "sudden"
}
</pre>

<h3>6.4.2 Event Types</h3>

<table border="1" cellpadding="10">
    <thead>
        <tr>
            <th>Event</th>
            <th>Trigger</th>
            <th>Use Case</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>emotion_change</td>
            <td>Primary emotion changes</td>
            <td>Logging, alerts</td>
        </tr>
        <tr>
            <td>high_arousal</td>
            <td>Arousal exceeds threshold</td>
            <td>Stress detection</td>
        </tr>
        <tr>
            <td>negative_valence</td>
            <td>Valence drops below threshold</td>
            <td>Dissatisfaction detection</td>
        </tr>
        <tr>
            <td>face_lost</td>
            <td>Face tracking lost</td>
            <td>Attention monitoring</td>
        </tr>
        <tr>
            <td>face_detected</td>
            <td>New face detected</td>
            <td>Presence detection</td>
        </tr>
        <tr>
            <td>micro_expression</td>
            <td>Brief expression detected</td>
            <td>Deception detection</td>
        </tr>
    </tbody>
</table>

<hr>

<h2>6.5 Security</h2>

<h3>6.5.1 Transport Security</h3>

<ul>
    <li><strong>TLS 1.3:</strong> Required for all connections</li>
    <li><strong>Certificate Pinning:</strong> Recommended for mobile apps</li>
    <li><strong>WSS only:</strong> No unencrypted WebSocket</li>
</ul>

<h3>6.5.2 Authentication</h3>

<pre>
API Key (in header):
X-WIA-API-Key: sk_live_abc123

JWT Token (in query or header):
wss://stream.wiastandards.com/v1/stream?token=eyJhbG...

Token Refresh:
{
    "type": "auth_refresh",
    "token": "new_jwt_token"
}
</pre>

<h3>6.5.3 Privacy Protection</h3>

<ul>
    <li><strong>End-to-end encryption:</strong> Optional for sensitive applications</li>
    <li><strong>No storage:</strong> Frames processed and discarded by default</li>
    <li><strong>Anonymization:</strong> subject_id should be pseudonymized</li>
    <li><strong>Consent signal:</strong> Include consent token in config</li>
</ul>

<hr>

<h2>6.6 Error Handling</h2>

<h3>6.6.1 Error Message</h3>

<pre>
{
    "type": "error",
    "code": "FACE_NOT_DETECTED",
    "message": "No face detected in frame 1543",
    "frame_number": 1543,
    "recoverable": true
}
</pre>

<h3>6.6.2 Error Codes</h3>

<table border="1" cellpadding="10">
    <thead>
        <tr>
            <th>Code</th>
            <th>Recoverable</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>FACE_NOT_DETECTED</td>
            <td>Yes</td>
            <td>Continue sending frames</td>
        </tr>
        <tr>
            <td>INVALID_FRAME</td>
            <td>Yes</td>
            <td>Skip frame, continue</td>
        </tr>
        <tr>
            <td>RATE_EXCEEDED</td>
            <td>Yes</td>
            <td>Reduce frame rate</td>
        </tr>
        <tr>
            <td>AUTH_EXPIRED</td>
            <td>Yes</td>
            <td>Refresh token</td>
        </tr>
        <tr>
            <td>STREAM_LIMIT</td>
            <td>No</td>
            <td>Close and reconnect</td>
        </tr>
        <tr>
            <td>SERVER_ERROR</td>
            <td>No</td>
            <td>Retry with backoff</td>
        </tr>
    </tbody>
</table>

<h3>6.6.3 Reconnection Strategy</h3>

<pre>
Exponential Backoff:
  Attempt 1: Wait 1 second
  Attempt 2: Wait 2 seconds
  Attempt 3: Wait 4 seconds
  Attempt 4: Wait 8 seconds
  Attempt 5: Wait 16 seconds
  Maximum: 60 seconds

Resume Stream:
{
    "type": "resume",
    "stream_id": "stream_abc123",
    "last_frame_number": 1542
}
</pre>

<hr>

<h2>6.7 Session Management</h2>

<h3>6.7.1 Session Lifecycle</h3>

<pre>
1. Connect (WebSocket handshake)
2. Configure (send config message)
3. Stream (send frames, receive results)
4. Pause (optional)
5. Resume (optional)
6. Close (graceful disconnect)

Session Limits:
  - Maximum duration: 4 hours
  - Maximum idle time: 5 minutes
  - Maximum frames: 1,000,000
</pre>

<h3>6.7.2 Session Summary</h3>

<pre>
On session close, receive:

{
    "type": "session_summary",
    "stream_id": "stream_abc123",
    "duration_ms": 3600000,
    "frames_processed": 108000,

    "emotion_distribution": {
        "happiness": 0.45,
        "neutral": 0.35,
        "sadness": 0.12,
        "other": 0.08
    },

    "average_dimensions": {
        "valence": 0.42,
        "arousal": 0.38
    },

    "events": {
        "emotion_changes": 47,
        "high_arousal_moments": 12
    }
}
</pre>

<hr>

<h2>6.8 Chapter Summary</h2>

<p>[OK] <strong>Key Takeaways:</strong></p>

<ol>
    <li><strong>WebSocket Primary:</strong> Real-time bidirectional communication</li>
    <li><strong>Low Latency:</strong> Target &lt;100ms end-to-end</li>
    <li><strong>Flexible Output:</strong> per_frame, per_second, on_change</li>
    <li><strong>Event-Based:</strong> emotion_change, high_arousal, etc.</li>
    <li><strong>Security:</strong> TLS 1.3, authentication, privacy</li>
    <li><strong>Resilience:</strong> Reconnection, session resume</li>
</ol>

<hr>

<p><strong>Chapter 6 Complete</strong> | Approximate pages: 14</p>

<p><a href="chapter-07.html">Next: Chapter 7 - Phase 4: Integration</a></p>

<hr>

<p><strong>WIA - World Certification Industry Association</strong></p>
<p>Hongik Ingan - Benefit All Humanity</p>
<p><a href="https://wiastandards.com">https://wiastandards.com</a></p>

</body>
</html>
