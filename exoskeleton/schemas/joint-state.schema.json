{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia-standards.org/exoskeleton/schemas/joint-state.schema.json",
  "title": "WIA Exoskeleton Joint State",
  "description": "Schema for rehabilitation exoskeleton joint state data",
  "type": "object",
  "required": ["joint", "side", "timestamp", "kinematics", "kinetics", "sensors"],
  "properties": {
    "joint": {
      "$ref": "#/definitions/JointType"
    },
    "side": {
      "type": "string",
      "enum": ["left", "right"],
      "description": "Left or right side of the body"
    },
    "timestamp": {
      "type": "integer",
      "minimum": 0,
      "description": "Unix timestamp in milliseconds"
    },
    "kinematics": {
      "$ref": "#/definitions/Kinematics"
    },
    "kinetics": {
      "$ref": "#/definitions/Kinetics"
    },
    "sensors": {
      "$ref": "#/definitions/SensorData"
    }
  },
  "definitions": {
    "JointType": {
      "type": "string",
      "enum": ["hip", "knee", "ankle"],
      "description": "Type of joint (hip, knee, or ankle)"
    },
    "Kinematics": {
      "type": "object",
      "description": "Kinematic data for joint motion",
      "required": ["angle", "angularVelocity", "angularAcceleration"],
      "properties": {
        "angle": {
          "type": "number",
          "description": "Joint angle in degrees (anatomical reference)",
          "minimum": -180,
          "maximum": 180
        },
        "angularVelocity": {
          "type": "number",
          "description": "Angular velocity in degrees per second"
        },
        "angularAcceleration": {
          "type": "number",
          "description": "Angular acceleration in degrees per second squared"
        }
      }
    },
    "Kinetics": {
      "type": "object",
      "description": "Kinetic data for joint forces",
      "required": ["torque", "assistTorque", "netTorque"],
      "properties": {
        "torque": {
          "type": "number",
          "description": "User-generated torque in Newton-meters"
        },
        "assistTorque": {
          "type": "number",
          "description": "Exoskeleton assist torque in Newton-meters"
        },
        "netTorque": {
          "type": "number",
          "description": "Net torque (torque + assistTorque) in Newton-meters"
        }
      }
    },
    "SensorData": {
      "type": "object",
      "description": "Raw sensor data",
      "required": ["encoder"],
      "properties": {
        "encoder": {
          "type": "number",
          "description": "Raw encoder counts"
        },
        "imu": {
          "$ref": "#/definitions/IMUData"
        },
        "forceplate": {
          "$ref": "#/definitions/ForceData"
        }
      }
    },
    "IMUData": {
      "type": "object",
      "description": "Inertial Measurement Unit data",
      "required": ["accelerometer", "gyroscope"],
      "properties": {
        "accelerometer": {
          "$ref": "#/definitions/Vector3D",
          "description": "3-axis acceleration in m/s²"
        },
        "gyroscope": {
          "$ref": "#/definitions/Vector3D",
          "description": "3-axis angular velocity in deg/s"
        },
        "magnetometer": {
          "$ref": "#/definitions/Vector3D",
          "description": "3-axis magnetic field in μT (optional)"
        }
      }
    },
    "ForceData": {
      "type": "object",
      "description": "Force plate data",
      "required": ["fx", "fy", "fz"],
      "properties": {
        "fx": {
          "type": "number",
          "description": "Force in X direction (N)"
        },
        "fy": {
          "type": "number",
          "description": "Force in Y direction (N)"
        },
        "fz": {
          "type": "number",
          "description": "Force in Z direction / vertical GRF (N)"
        },
        "mx": {
          "type": "number",
          "description": "Moment about X axis (Nm)"
        },
        "my": {
          "type": "number",
          "description": "Moment about Y axis (Nm)"
        },
        "mz": {
          "type": "number",
          "description": "Moment about Z axis (Nm)"
        },
        "cop": {
          "$ref": "#/definitions/Vector2D",
          "description": "Center of Pressure (m)"
        }
      }
    },
    "Vector3D": {
      "type": "object",
      "description": "3D vector",
      "required": ["x", "y", "z"],
      "properties": {
        "x": {
          "type": "number"
        },
        "y": {
          "type": "number"
        },
        "z": {
          "type": "number"
        }
      }
    },
    "Vector2D": {
      "type": "object",
      "description": "2D vector",
      "required": ["x", "y"],
      "properties": {
        "x": {
          "type": "number"
        },
        "y": {
          "type": "number"
        }
      }
    }
  },
  "examples": [
    {
      "joint": "knee",
      "side": "right",
      "timestamp": 1702598400000,
      "kinematics": {
        "angle": 45.2,
        "angularVelocity": 120.5,
        "angularAcceleration": 15.3
      },
      "kinetics": {
        "torque": 12.5,
        "assistTorque": 8.3,
        "netTorque": 20.8
      },
      "sensors": {
        "encoder": 32768,
        "imu": {
          "accelerometer": { "x": 0.15, "y": -0.08, "z": -9.78 },
          "gyroscope": { "x": 5.2, "y": -2.1, "z": 0.3 }
        }
      }
    }
  ]
}
