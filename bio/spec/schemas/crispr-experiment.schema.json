{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.live/schemas/bio/crispr-experiment.schema.json",
  "title": "WIA Biotech CRISPR Experiment",
  "description": "Schema for CRISPR gene editing experiment data",
  "type": "object",
  "required": [
    "experiment_id",
    "target",
    "editing_system",
    "guide_rnas"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri"
    },
    "experiment_id": {
      "type": "string",
      "pattern": "^crispr-exp-[a-zA-Z0-9-]+$",
      "description": "Unique experiment identifier"
    },
    "experiment_info": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Experiment name"
        },
        "description": {
          "type": "string",
          "description": "Experiment description"
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "Experiment date"
        },
        "experimenter": {
          "type": "string",
          "description": "Experimenter name"
        }
      }
    },
    "target": {
      "type": "object",
      "required": ["gene_symbol"],
      "properties": {
        "gene_symbol": {
          "type": "string",
          "description": "Target gene symbol"
        },
        "gene_id": {
          "type": "string",
          "description": "Target gene ID"
        },
        "organism": {
          "type": "string",
          "description": "Target organism"
        },
        "cell_line": {
          "type": "string",
          "description": "Cell line used"
        },
        "cell_type": {
          "type": "string",
          "description": "Primary cell type"
        },
        "sequence_ref": {
          "type": "string",
          "description": "Reference to target sequence"
        }
      }
    },
    "editing_system": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "crispr_cas9",
            "crispr_saCas9",
            "crispr_cas12a",
            "crispr_cas13",
            "base_editor",
            "prime_editor"
          ],
          "description": "CRISPR system type"
        },
        "cas_variant": {
          "type": "string",
          "description": "Cas protein variant"
        },
        "pam_sequence": {
          "type": "string",
          "description": "PAM sequence requirement"
        },
        "delivery_method": {
          "type": "string",
          "enum": [
            "lipofection",
            "electroporation",
            "viral_aav",
            "viral_lentivirus",
            "rnp",
            "microinjection",
            "other"
          ],
          "description": "Delivery method"
        }
      }
    },
    "guide_rnas": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["grna_id", "sequence"],
        "properties": {
          "grna_id": {
            "type": "string",
            "description": "Guide RNA identifier"
          },
          "name": {
            "type": "string",
            "description": "Guide RNA name"
          },
          "sequence": {
            "type": "string",
            "pattern": "^[ATCGU]+$",
            "description": "Guide RNA sequence (20nt typically)"
          },
          "target_start": {
            "type": "integer",
            "description": "Target start position"
          },
          "target_end": {
            "type": "integer",
            "description": "Target end position"
          },
          "strand": {
            "type": "string",
            "enum": ["+", "-"],
            "description": "Target strand"
          },
          "pam": {
            "type": "string",
            "description": "PAM sequence at target"
          },
          "off_target_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Off-target specificity score"
          },
          "on_target_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "On-target efficiency score"
          }
        }
      },
      "description": "Guide RNA definitions"
    },
    "editing_type": {
      "type": "string",
      "enum": [
        "knockout",
        "knockin",
        "base_edit",
        "prime_edit",
        "crispri",
        "crispra",
        "epigenome"
      ],
      "description": "Type of editing"
    },
    "repair_template": {
      "type": ["object", "null"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ssODN", "dsDNA", "plasmid"],
          "description": "Repair template type"
        },
        "sequence": {
          "type": "string",
          "description": "Template sequence"
        },
        "homology_arm_left": {
          "type": "integer",
          "description": "Left homology arm length"
        },
        "homology_arm_right": {
          "type": "integer",
          "description": "Right homology arm length"
        }
      },
      "description": "HDR repair template (null for NHEJ)"
    },
    "protocol": {
      "type": "object",
      "properties": {
        "cas9_concentration_nm": {
          "type": "number",
          "description": "Cas9 concentration in nM"
        },
        "grna_concentration_nm": {
          "type": "number",
          "description": "gRNA concentration in nM"
        },
        "transfection_reagent": {
          "type": "string",
          "description": "Transfection reagent used"
        },
        "incubation_hours": {
          "type": "number",
          "description": "Incubation time in hours"
        },
        "selection_method": {
          "type": "string",
          "description": "Selection method if used"
        }
      }
    },
    "results_ref": {
      "type": "string",
      "description": "Reference to results file"
    }
  }
}
