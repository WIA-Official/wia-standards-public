{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.live/schemas/bio/crispr-results.schema.json",
  "title": "WIA Biotech CRISPR Results",
  "description": "Schema for CRISPR gene editing experiment results",
  "type": "object",
  "required": [
    "results_id",
    "experiment_ref"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri"
    },
    "results_id": {
      "type": "string",
      "pattern": "^results-[a-zA-Z0-9-]+$",
      "description": "Unique results identifier"
    },
    "experiment_ref": {
      "type": "string",
      "description": "Reference to experiment"
    },
    "analysis_date": {
      "type": "string",
      "format": "date",
      "description": "Analysis date"
    },
    "analysis_method": {
      "type": "string",
      "enum": [
        "NGS",
        "sanger",
        "t7e1",
        "surveyor",
        "tide",
        "ice",
        "other"
      ],
      "description": "Analysis method used"
    },
    "editing_efficiency": {
      "type": "object",
      "properties": {
        "overall_efficiency": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Overall editing efficiency"
        },
        "indel_frequency": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Indel frequency (NHEJ)"
        },
        "hdr_frequency": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 1,
          "description": "HDR frequency (if applicable)"
        },
        "wild_type_frequency": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Wild type allele frequency"
        }
      }
    },
    "indel_profile": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["deletion", "insertion", "substitution", "complex"],
            "description": "Indel type"
          },
          "size_bp": {
            "type": "integer",
            "description": "Size in base pairs (negative for deletions)"
          },
          "frequency": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Frequency of this indel"
          },
          "sequence": {
            "type": "string",
            "description": "Resulting sequence"
          }
        }
      },
      "description": "Indel profile distribution"
    },
    "off_target_analysis": {
      "type": "object",
      "properties": {
        "method": {
          "type": "string",
          "enum": [
            "GUIDE-seq",
            "CIRCLE-seq",
            "DISCOVER-seq",
            "SITE-seq",
            "Digenome-seq",
            "computational",
            "other"
          ],
          "description": "Off-target detection method"
        },
        "sites_detected": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of off-target sites detected"
        },
        "sites": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "chromosome": {
                "type": "string",
                "description": "Chromosome"
              },
              "position": {
                "type": "integer",
                "description": "Genomic position"
              },
              "mismatches": {
                "type": "integer",
                "description": "Number of mismatches to guide"
              },
              "frequency": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Editing frequency at this site"
              },
              "gene": {
                "type": "string",
                "description": "Gene affected (if any)"
              }
            }
          },
          "description": "Off-target sites details"
        }
      }
    },
    "quality_metrics": {
      "type": "object",
      "properties": {
        "sequencing_depth": {
          "type": "integer",
          "description": "Average sequencing depth"
        },
        "mapping_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Read mapping rate"
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Overall confidence score"
        }
      }
    },
    "files": {
      "type": "object",
      "properties": {
        "raw_fastq": {
          "type": "string",
          "description": "Raw FASTQ file path"
        },
        "aligned_bam": {
          "type": "string",
          "description": "Aligned BAM file path"
        },
        "analysis_report": {
          "type": "string",
          "description": "Analysis report file path"
        }
      }
    }
  }
}
