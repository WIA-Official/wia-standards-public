{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wia.live/health/schemas/common.schema.json",
  "title": "WIA Health Common Definitions",
  "description": "Shared type definitions for WIA Health Standard",
  "$defs": {
    "UUID": {
      "type": "string",
      "format": "uuid",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "UUID v4 identifier"
    },
    "Timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp"
    },
    "Date": {
      "type": "string",
      "format": "date",
      "description": "ISO 8601 date"
    },
    "SemVer": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9]+)?$",
      "description": "Semantic version string"
    },
    "Measurement": {
      "type": "object",
      "properties": {
        "value": {
          "type": "number",
          "description": "Numeric measurement value"
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement"
        },
        "referenceRange": {
          "$ref": "#/$defs/ReferenceRange"
        },
        "timestamp": {
          "$ref": "#/$defs/Timestamp"
        },
        "method": {
          "type": "string",
          "description": "Measurement method or assay"
        },
        "laboratory": {
          "type": "string",
          "description": "Laboratory that performed the test"
        },
        "flags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["normal", "abnormal", "critical", "low", "high"]
          }
        },
        "notes": {
          "type": "string"
        }
      },
      "required": ["value", "unit"],
      "additionalProperties": false
    },
    "ReferenceRange": {
      "type": "object",
      "properties": {
        "low": {
          "type": "number"
        },
        "high": {
          "type": "number"
        },
        "unit": {
          "type": "string"
        },
        "population": {
          "type": "string",
          "description": "Reference population (e.g., age group, sex)"
        }
      },
      "additionalProperties": false
    },
    "Identifier": {
      "type": "object",
      "properties": {
        "system": {
          "type": "string",
          "format": "uri",
          "description": "Identifier system URI"
        },
        "value": {
          "type": "string",
          "description": "Identifier value"
        }
      },
      "required": ["system", "value"],
      "additionalProperties": false
    },
    "Metadata": {
      "type": "object",
      "properties": {
        "version": {
          "$ref": "#/$defs/SemVer"
        },
        "createdAt": {
          "$ref": "#/$defs/Timestamp"
        },
        "updatedAt": {
          "$ref": "#/$defs/Timestamp"
        },
        "source": {
          "type": "object",
          "properties": {
            "system": {
              "type": "string"
            },
            "version": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["version", "createdAt"],
      "additionalProperties": false
    },
    "Consent": {
      "type": "object",
      "properties": {
        "dataSharing": {
          "type": "boolean",
          "description": "Consent for data sharing"
        },
        "research": {
          "type": "boolean",
          "description": "Consent for research use"
        },
        "consentDate": {
          "$ref": "#/$defs/Date"
        },
        "version": {
          "type": "string",
          "description": "Consent form version"
        },
        "expirationDate": {
          "$ref": "#/$defs/Date"
        }
      },
      "required": ["dataSharing", "consentDate"],
      "additionalProperties": false
    },
    "Subject": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/$defs/UUID"
        },
        "anonymizedId": {
          "type": "string",
          "description": "Anonymized identifier for research"
        },
        "birthYear": {
          "type": "integer",
          "minimum": 1900,
          "maximum": 2100
        },
        "biologicalSex": {
          "type": "string",
          "enum": ["male", "female", "other", "unknown"]
        },
        "ethnicity": {
          "type": "string"
        },
        "consent": {
          "$ref": "#/$defs/Consent"
        }
      },
      "required": ["id"],
      "additionalProperties": false
    }
  }
}
