{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://wia.live/health/schemas/digital-twin.schema.json",
  "title": "WIA Health Digital Twin Profile",
  "description": "Digital twin model for personalized health simulation and prediction",
  "type": "object",
  "properties": {
    "id": {
      "$ref": "common.schema.json#/$defs/UUID"
    },
    "version": {
      "$ref": "common.schema.json#/$defs/SemVer"
    },
    "type": {
      "type": "string",
      "enum": ["wholeBody", "cardiac", "metabolic", "neurological", "respiratory", "musculoskeletal", "custom"],
      "description": "Type of digital twin model"
    },
    "status": {
      "type": "string",
      "enum": ["active", "archived", "updating", "calibrating", "error"],
      "description": "Current status of the digital twin"
    },
    "fidelity": {
      "type": "string",
      "enum": ["low", "medium", "high", "research"],
      "description": "Model fidelity level"
    },
    "dataStreams": {
      "type": "object",
      "description": "Data sources feeding the digital twin",
      "properties": {
        "clinical": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "sources": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["EHR", "lab", "imaging", "pathology", "pharmacy"]
              }
            },
            "lastSync": {
              "$ref": "common.schema.json#/$defs/Timestamp"
            },
            "fhirEndpoint": {
              "type": "string",
              "format": "uri"
            }
          },
          "additionalProperties": false
        },
        "physiological": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "sources": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["wearables", "cgm", "ecg", "bp_monitor", "pulse_ox", "sleep_tracker", "smart_scale"]
              }
            },
            "frequency": {
              "type": "string",
              "enum": ["realtime", "continuous", "hourly", "daily", "weekly"]
            },
            "lastSync": {
              "$ref": "common.schema.json#/$defs/Timestamp"
            }
          },
          "additionalProperties": false
        },
        "behavioral": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "sources": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["activity", "sleep", "nutrition", "stress", "mood", "social"]
              }
            },
            "privacy": {
              "type": "string",
              "enum": ["anonymized", "pseudonymized", "identified"]
            },
            "lastSync": {
              "$ref": "common.schema.json#/$defs/Timestamp"
            }
          },
          "additionalProperties": false
        },
        "environmental": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "sources": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["air_quality", "uv_index", "temperature", "humidity", "pollution", "allergens"]
              }
            },
            "location": {
              "type": "string",
              "enum": ["gps", "zipcode", "city", "none"]
            },
            "lastSync": {
              "$ref": "common.schema.json#/$defs/Timestamp"
            }
          },
          "additionalProperties": false
        },
        "genomic": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "dataTypes": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["variants", "expression", "methylation", "microbiome"]
              }
            },
            "lastSync": {
              "$ref": "common.schema.json#/$defs/Timestamp"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "models": {
      "type": "array",
      "description": "Organ-specific or system-specific models",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "$ref": "common.schema.json#/$defs/UUID"
          },
          "organ": {
            "type": "string",
            "enum": [
              "heart",
              "brain",
              "liver",
              "kidney",
              "pancreas",
              "lung",
              "gut",
              "vascular",
              "immune",
              "endocrine",
              "musculoskeletal"
            ]
          },
          "modelType": {
            "type": "string",
            "enum": ["physiological", "mechanical", "metabolic", "electrical", "hybrid"]
          },
          "algorithm": {
            "type": "string",
            "description": "Model algorithm or framework"
          },
          "accuracy": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Validated accuracy score"
          },
          "lastCalibrated": {
            "$ref": "common.schema.json#/$defs/Timestamp"
          },
          "calibrationData": {
            "type": "string",
            "description": "Reference to calibration dataset"
          },
          "predictions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "outcome": {
                  "type": "string",
                  "description": "Predicted outcome or event"
                },
                "probability": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                },
                "timeframe": {
                  "type": "string",
                  "description": "Time horizon for prediction"
                },
                "confidence": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                },
                "calculatedAt": {
                  "$ref": "common.schema.json#/$defs/Timestamp"
                }
              },
              "additionalProperties": false
            }
          }
        },
        "additionalProperties": false
      }
    },
    "simulations": {
      "type": "array",
      "description": "Simulation history and results",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "$ref": "common.schema.json#/$defs/UUID"
          },
          "type": {
            "type": "string",
            "enum": [
              "drugResponse",
              "surgery",
              "lifestyle",
              "disease",
              "intervention",
              "aging",
              "whatIf"
            ]
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "parameters": {
            "type": "object",
            "description": "Simulation input parameters",
            "additionalProperties": true
          },
          "results": {
            "type": "object",
            "description": "Simulation output results",
            "additionalProperties": true
          },
          "timestamp": {
            "$ref": "common.schema.json#/$defs/Timestamp"
          },
          "duration": {
            "type": "number",
            "description": "Simulation runtime in seconds"
          },
          "status": {
            "type": "string",
            "enum": ["completed", "failed", "running", "queued"]
          }
        },
        "additionalProperties": false
      }
    },
    "healthScore": {
      "type": "object",
      "description": "Aggregated health score from digital twin",
      "properties": {
        "overall": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "components": {
          "type": "object",
          "properties": {
            "cardiovascular": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "metabolic": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "cognitive": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "immune": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "musculoskeletal": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          },
          "additionalProperties": false
        },
        "trend": {
          "type": "string",
          "enum": ["improving", "stable", "declining"]
        },
        "calculatedAt": {
          "$ref": "common.schema.json#/$defs/Timestamp"
        }
      },
      "additionalProperties": false
    },
    "lastUpdated": {
      "$ref": "common.schema.json#/$defs/Timestamp"
    },
    "nextCalibration": {
      "$ref": "common.schema.json#/$defs/Timestamp"
    },
    "metadata": {
      "$ref": "common.schema.json#/$defs/Metadata"
    }
  },
  "required": ["id", "version", "type", "status"],
  "additionalProperties": false
}
