{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.live/schemas/robot/v1/wrp-error.schema.json",
  "title": "WIA Robot Protocol Error Message",
  "description": "Error message schema for WRP",
  "definitions": {
    "ErrorCode": {
      "type": "integer",
      "enum": [
        1000, 1001, 1002, 1003,
        2000, 2001, 2002, 2003,
        3000, 3001, 3002,
        4000, 4001, 4002,
        5000, 5001, 5002
      ],
      "description": "Error code"
    },
    "ErrorName": {
      "type": "string",
      "enum": [
        "INVALID_MESSAGE",
        "CHECKSUM_FAILED",
        "UNSUPPORTED_VERSION",
        "UNKNOWN_MESSAGE_TYPE",
        "CONNECTION_FAILED",
        "HANDSHAKE_FAILED",
        "HEARTBEAT_TIMEOUT",
        "ACK_TIMEOUT",
        "SAFETY_VIOLATION",
        "EMERGENCY_STOP",
        "SAFETY_LIMIT_EXCEEDED",
        "DEVICE_ERROR",
        "DEVICE_OFFLINE",
        "DEVICE_BUSY",
        "COMMAND_REJECTED",
        "INVALID_PARAMETER",
        "COMMAND_TIMEOUT"
      ],
      "description": "Error name"
    },
    "ErrorPayload": {
      "type": "object",
      "required": ["error_code", "error_name", "message"],
      "properties": {
        "error_code": {
          "$ref": "#/definitions/ErrorCode"
        },
        "error_name": {
          "$ref": "#/definitions/ErrorName"
        },
        "message": {
          "type": "string",
          "description": "Human-readable error message"
        },
        "details": {
          "type": "object",
          "description": "Additional error details"
        },
        "recoverable": {
          "type": "boolean",
          "default": false,
          "description": "Whether the error is recoverable"
        },
        "suggested_action": {
          "type": "string",
          "enum": [
            "resend_message",
            "reconnect",
            "reset_device",
            "manual_intervention",
            "contact_support",
            "update_firmware",
            "recalibrate",
            "check_parameters",
            "none"
          ],
          "description": "Suggested action to resolve"
        },
        "related_message_id": {
          "type": "string",
          "format": "uuid",
          "description": "ID of the message that caused the error"
        },
        "stack_trace": {
          "type": "string",
          "description": "Stack trace for debugging (only in debug mode)"
        }
      }
    },
    "ErrorCategory": {
      "type": "object",
      "properties": {
        "message_errors": {
          "type": "object",
          "description": "Message format errors (1000-1999)",
          "properties": {
            "INVALID_MESSAGE": {
              "const": 1000,
              "description": "Message format is invalid"
            },
            "CHECKSUM_FAILED": {
              "const": 1001,
              "description": "Checksum verification failed"
            },
            "UNSUPPORTED_VERSION": {
              "const": 1002,
              "description": "Protocol version not supported"
            },
            "UNKNOWN_MESSAGE_TYPE": {
              "const": 1003,
              "description": "Unknown message type"
            }
          }
        },
        "connection_errors": {
          "type": "object",
          "description": "Connection errors (2000-2999)",
          "properties": {
            "CONNECTION_FAILED": {
              "const": 2000,
              "description": "Connection to endpoint failed"
            },
            "HANDSHAKE_FAILED": {
              "const": 2001,
              "description": "Handshake process failed"
            },
            "HEARTBEAT_TIMEOUT": {
              "const": 2002,
              "description": "Heartbeat timeout"
            },
            "ACK_TIMEOUT": {
              "const": 2003,
              "description": "Acknowledgment timeout"
            }
          }
        },
        "safety_errors": {
          "type": "object",
          "description": "Safety errors (3000-3999)",
          "properties": {
            "SAFETY_VIOLATION": {
              "const": 3000,
              "description": "Safety requirement violated"
            },
            "EMERGENCY_STOP": {
              "const": 3001,
              "description": "Emergency stop triggered"
            },
            "SAFETY_LIMIT_EXCEEDED": {
              "const": 3002,
              "description": "Safety limit exceeded"
            }
          }
        },
        "device_errors": {
          "type": "object",
          "description": "Device errors (4000-4999)",
          "properties": {
            "DEVICE_ERROR": {
              "const": 4000,
              "description": "General device error"
            },
            "DEVICE_OFFLINE": {
              "const": 4001,
              "description": "Device is offline"
            },
            "DEVICE_BUSY": {
              "const": 4002,
              "description": "Device is busy"
            }
          }
        },
        "command_errors": {
          "type": "object",
          "description": "Command errors (5000-5999)",
          "properties": {
            "COMMAND_REJECTED": {
              "const": 5000,
              "description": "Command was rejected"
            },
            "INVALID_PARAMETER": {
              "const": 5001,
              "description": "Invalid parameter in command"
            },
            "COMMAND_TIMEOUT": {
              "const": 5002,
              "description": "Command execution timeout"
            }
          }
        }
      }
    }
  },
  "type": "object",
  "properties": {
    "type": {
      "const": "error"
    },
    "payload": {
      "$ref": "#/definitions/ErrorPayload"
    }
  },
  "examples": [
    {
      "type": "error",
      "payload": {
        "error_code": 1001,
        "error_name": "CHECKSUM_FAILED",
        "message": "Message checksum verification failed",
        "details": {
          "expected": "a1b2c3d4",
          "actual": "e5f6g7h8"
        },
        "recoverable": true,
        "suggested_action": "resend_message",
        "related_message_id": "550e8400-e29b-41d4-a716-446655440000"
      }
    },
    {
      "type": "error",
      "payload": {
        "error_code": 3001,
        "error_name": "EMERGENCY_STOP",
        "message": "Emergency stop has been triggered",
        "details": {
          "source": "UserButton",
          "timestamp": "2025-01-15T10:30:00Z"
        },
        "recoverable": false,
        "suggested_action": "manual_intervention"
      }
    }
  ]
}
