{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.live/schemas/robot/v1/exoskeleton.schema.json",
  "title": "WIA Exoskeleton Data Schema",
  "description": "Schema for exoskeleton robot data",
  "allOf": [
    { "$ref": "device.schema.json" },
    {
      "properties": {
        "device": {
          "properties": {
            "type": { "const": "exoskeleton" }
          }
        },
        "spec": {
          "$ref": "#/definitions/ExoskeletonSpec"
        }
      }
    }
  ],
  "definitions": {
    "ExoskeletonSpec": {
      "type": "object",
      "required": ["type", "joints", "control"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["lower_body", "upper_body", "full_body"]
        },
        "joints": {
          "type": "array",
          "items": { "$ref": "#/definitions/ExoJoint" }
        },
        "gait": {
          "$ref": "#/definitions/GaitData"
        },
        "sensors": {
          "type": "object",
          "properties": {
            "imu": {
              "type": "array",
              "items": { "$ref": "#/definitions/IMUData" }
            },
            "force_sensors": {
              "type": "array",
              "items": { "$ref": "#/definitions/ForceSensor" }
            }
          }
        },
        "control": {
          "$ref": "#/definitions/ControlParams"
        },
        "training": {
          "type": "object",
          "properties": {
            "program_id": { "type": "string" },
            "step_count": { "type": "integer" },
            "distance_m": { "type": "number" },
            "calories_burned": { "type": "number" }
          }
        }
      }
    },
    "ExoJoint": {
      "type": "object",
      "required": ["name", "angle_deg", "velocity_deg_s", "torque_nm", "min_angle_deg", "max_angle_deg"],
      "properties": {
        "name": {
          "type": "string"
        },
        "angle_deg": {
          "type": "number",
          "description": "Current joint angle in degrees"
        },
        "velocity_deg_s": {
          "type": "number",
          "description": "Angular velocity in degrees per second"
        },
        "acceleration_deg_s2": {
          "type": "number"
        },
        "torque_nm": {
          "type": "number",
          "description": "Measured torque in Newton-meters"
        },
        "assist_torque_nm": {
          "type": "number",
          "description": "Assistance torque provided"
        },
        "target_angle_deg": {
          "type": "number"
        },
        "min_angle_deg": {
          "type": "number"
        },
        "max_angle_deg": {
          "type": "number"
        }
      }
    },
    "GaitData": {
      "type": "object",
      "required": ["phase", "cycle_percent", "step_count", "cadence_steps_min", "stride_length_cm", "velocity_m_s"],
      "properties": {
        "phase": {
          "type": "string",
          "enum": ["stance", "swing", "double_support", "heel_strike", "toe_off", "mid_stance"]
        },
        "side": {
          "type": "string",
          "enum": ["left", "right"]
        },
        "cycle_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "step_count": {
          "type": "integer"
        },
        "cadence_steps_min": {
          "type": "number"
        },
        "stride_length_cm": {
          "type": "number"
        },
        "step_width_cm": {
          "type": "number"
        },
        "velocity_m_s": {
          "type": "number"
        },
        "symmetry_index": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "IMUData": {
      "type": "object",
      "required": ["location", "acceleration", "gyroscope"],
      "properties": {
        "location": { "type": "string" },
        "acceleration": { "$ref": "#/definitions/Vector3D" },
        "gyroscope": { "$ref": "#/definitions/Vector3D" },
        "orientation": {
          "type": "object",
          "properties": {
            "roll": { "type": "number" },
            "pitch": { "type": "number" },
            "yaw": { "type": "number" }
          }
        }
      }
    },
    "ForceSensor": {
      "type": "object",
      "required": ["location", "force_n"],
      "properties": {
        "location": { "type": "string" },
        "force_n": { "type": "number" }
      }
    },
    "ControlParams": {
      "type": "object",
      "required": ["mode", "assist_level"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["assist", "resist", "passive", "transparent"]
        },
        "assist_level": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "impedance": {
          "type": "object",
          "properties": {
            "stiffness": { "type": "number" },
            "damping": { "type": "number" },
            "inertia": { "type": "number" }
          }
        }
      }
    },
    "Vector3D": {
      "type": "object",
      "required": ["x", "y", "z"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      }
    }
  }
}
