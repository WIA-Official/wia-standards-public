{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.live/schemas/robot/v1/prosthetics.schema.json",
  "title": "WIA Prosthetics Data Schema",
  "description": "Schema for prosthetic limb data",
  "allOf": [
    { "$ref": "device.schema.json" },
    {
      "properties": {
        "device": {
          "properties": {
            "type": { "const": "prosthetics" }
          }
        },
        "spec": {
          "$ref": "#/definitions/ProstheticsSpec"
        }
      }
    }
  ],
  "definitions": {
    "ProstheticsSpec": {
      "type": "object",
      "required": ["type", "side", "dof"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["hand", "arm", "leg", "foot"]
        },
        "side": {
          "type": "string",
          "enum": ["left", "right"]
        },
        "dof": {
          "type": "integer",
          "minimum": 1,
          "description": "Degrees of freedom"
        },
        "fingers": {
          "type": "array",
          "items": { "$ref": "#/definitions/FingerData" }
        },
        "wrist": { "$ref": "#/definitions/JointData" },
        "elbow": { "$ref": "#/definitions/JointData" },
        "shoulder": { "$ref": "#/definitions/JointData" },
        "knee": { "$ref": "#/definitions/JointData" },
        "ankle": { "$ref": "#/definitions/JointData" },
        "emg_sensors": {
          "type": "array",
          "items": { "$ref": "#/definitions/EMGSensor" }
        },
        "grip": {
          "$ref": "#/definitions/GripData"
        },
        "sensory_feedback": {
          "$ref": "#/definitions/SensoryFeedback"
        },
        "adaptation": {
          "$ref": "#/definitions/AdaptationSettings"
        }
      }
    },
    "FingerData": {
      "type": "object",
      "required": ["name", "position", "velocity", "force_n"],
      "properties": {
        "name": {
          "type": "string",
          "enum": ["thumb", "index", "middle", "ring", "pinky"]
        },
        "position": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "0 = open, 1 = closed"
        },
        "velocity": {
          "type": "number"
        },
        "force_n": {
          "type": "number"
        },
        "target_position": {
          "type": "number"
        },
        "tactile_pressure": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "EMGSensor": {
      "type": "object",
      "required": ["channel", "muscle_site", "signal_mv", "activation_level", "contraction_detected"],
      "properties": {
        "channel": {
          "type": "integer"
        },
        "muscle_site": {
          "type": "string"
        },
        "signal_mv": {
          "type": "number",
          "description": "Raw EMG signal in millivolts"
        },
        "signal_filtered_mv": {
          "type": "number"
        },
        "activation_level": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "contraction_detected": {
          "type": "boolean"
        }
      }
    },
    "GripData": {
      "type": "object",
      "required": ["type", "force_n", "opening_percent"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["power", "precision", "lateral", "hook", "tripod", "custom"]
        },
        "force_n": {
          "type": "number"
        },
        "opening_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "SensoryFeedback": {
      "type": "object",
      "properties": {
        "tactile_enabled": { "type": "boolean" },
        "vibration_intensity": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "temperature_c": { "type": "number" },
        "pressure_zones": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "zone_id": { "type": "string" },
              "location": { "type": "string" },
              "pressure": { "type": "number" }
            }
          }
        }
      }
    },
    "AdaptationSettings": {
      "type": "object",
      "properties": {
        "terrain_mode": {
          "type": "string",
          "enum": ["flat", "stairs", "ramp", "uneven"]
        },
        "speed_mode": {
          "type": "string",
          "enum": ["slow", "normal", "fast"]
        },
        "activity_mode": {
          "type": "string",
          "enum": ["walking", "running", "sitting", "cycling", "standing"]
        }
      }
    },
    "JointData": {
      "type": "object",
      "required": ["angle_deg", "min_angle_deg", "max_angle_deg"],
      "properties": {
        "angle_deg": { "type": "number" },
        "velocity_deg_s": { "type": "number" },
        "torque_nm": { "type": "number" },
        "min_angle_deg": { "type": "number" },
        "max_angle_deg": { "type": "number" }
      }
    }
  }
}
