{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wia.live/schemas/robot/v1/rehabilitation.schema.json",
  "title": "WIA Rehabilitation Robot Data Schema",
  "description": "Schema for rehabilitation robot data",
  "allOf": [
    { "$ref": "device.schema.json" },
    {
      "properties": {
        "device": {
          "properties": {
            "type": { "const": "rehabilitation" }
          }
        },
        "spec": {
          "$ref": "#/definitions/RehabilitationSpec"
        }
      }
    }
  ],
  "definitions": {
    "RehabilitationSpec": {
      "type": "object",
      "required": ["therapy_type", "device_type", "exercise", "trajectory", "patient_effort", "performance", "session"],
      "properties": {
        "therapy_type": {
          "type": "string",
          "enum": ["upper_limb", "lower_limb", "hand", "gait", "balance"]
        },
        "device_type": {
          "type": "string",
          "enum": ["end_effector", "exoskeleton", "treadmill", "platform"]
        },
        "exercise": {
          "$ref": "#/definitions/ExerciseData"
        },
        "trajectory": {
          "$ref": "#/definitions/TrajectoryData"
        },
        "patient_effort": {
          "$ref": "#/definitions/PatientEffort"
        },
        "performance": {
          "$ref": "#/definitions/PerformanceMetrics"
        },
        "session": {
          "$ref": "#/definitions/SessionData"
        },
        "biofeedback": {
          "$ref": "#/definitions/Biofeedback"
        }
      }
    },
    "ExerciseData": {
      "type": "object",
      "required": ["name", "exercise_type", "repetition", "total_repetitions", "duration_seconds", "difficulty_level"],
      "properties": {
        "name": { "type": "string" },
        "exercise_type": { "type": "string" },
        "repetition": { "type": "integer" },
        "total_repetitions": { "type": "integer" },
        "set": { "type": "integer" },
        "total_sets": { "type": "integer" },
        "duration_seconds": { "type": "number" },
        "difficulty_level": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10
        },
        "game_id": { "type": "string" }
      }
    },
    "TrajectoryData": {
      "type": "object",
      "required": ["current_position", "target_position", "path_completion"],
      "properties": {
        "current_position": { "$ref": "#/definitions/Position3D" },
        "target_position": { "$ref": "#/definitions/Position3D" },
        "start_position": { "$ref": "#/definitions/Position3D" },
        "velocity_m_s": { "type": "number" },
        "path_completion": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "path_type": {
          "type": "string",
          "enum": ["linear", "circular", "custom"]
        }
      }
    },
    "PatientEffort": {
      "type": "object",
      "required": ["active_participation", "assist_as_needed"],
      "properties": {
        "active_participation": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "assist_as_needed": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "resistance_nm": { "type": "number" },
        "force_applied": { "$ref": "#/definitions/Vector3D" },
        "emg_activation": { "type": "number" }
      }
    },
    "PerformanceMetrics": {
      "type": "object",
      "required": ["rom_achieved_deg", "rom_target_deg", "smoothness_score", "accuracy_cm"],
      "properties": {
        "rom_achieved_deg": { "type": "number" },
        "rom_target_deg": { "type": "number" },
        "rom_baseline_deg": { "type": "number" },
        "smoothness_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "accuracy_cm": { "type": "number" },
        "speed_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "error_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "SessionData": {
      "type": "object",
      "required": ["session_id", "start_time", "elapsed_seconds", "progress_percent"],
      "properties": {
        "session_id": { "type": "string" },
        "therapist_id": { "type": "string" },
        "start_time": {
          "type": "string",
          "format": "date-time"
        },
        "elapsed_seconds": { "type": "number" },
        "progress_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "notes": { "type": "string" }
      }
    },
    "Biofeedback": {
      "type": "object",
      "properties": {
        "heart_rate_bpm": { "type": "number" },
        "fatigue_level": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "pain_reported": {
          "type": "number",
          "minimum": 0,
          "maximum": 10
        }
      }
    },
    "Position3D": {
      "type": "object",
      "required": ["x", "y", "z"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      }
    },
    "Vector3D": {
      "type": "object",
      "required": ["x", "y", "z"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "z": { "type": "number" }
      }
    }
  }
}
